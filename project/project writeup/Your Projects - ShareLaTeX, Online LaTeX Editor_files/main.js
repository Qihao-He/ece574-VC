(function(){angular.module("RecursionHelper",[]).factory("RecursionHelper",["$compile",function($compile){return{compile:function(element,link){var compiledContents,contents;return angular.isFunction(link)&&(link={post:link}),contents=element.contents().remove(),compiledContents=void 0,{pre:link&&link.pre?link.pre:null,post:function(scope,element){compiledContents||(compiledContents=$compile(contents)),compiledContents(scope,function(clone){element.append(clone)}),link&&link.post&&link.post.apply(null,arguments)}}}}}])}).call(this),define("modules/recursionHelper",function(){}),function(){var app;app=angular.module("ErrorCatcher",[]),app.config(["$provide",function($provide){return $provide.decorator("$exceptionHandler",["$log","$delegate",function($log,$delegate){return function(exception,cause){return null!=("undefined"!=typeof Raven&&null!==Raven?Raven.captureException:void 0)&&Raven.captureException(exception),$delegate(exception,cause)}}])}]),app.factory("unAuthHttpResponseInterceptor",["$q","$location",function($q,$location){return{responseError:function(response){var _ref,_ref1;return 401!==(_ref=response.status)&&403!==_ref||(null!=(_ref1=response.config)?_ref1.disableAutoLoginRedirect:void 0)||(window.location.pathname.match(/^\/project/)?window.location="/login?redir="+encodeURI(window.location.pathname):window.location="/login"),$q.reject(response)}}}]),app.config(["$httpProvider",function($httpProvider){return $httpProvider.interceptors.push("unAuthHttpResponseInterceptor")}])}.call(this),define("modules/errorCatcher",function(){}),function(){var __slice=[].slice;angular.module("localStorage",[]).value("localStorage",function(){var args,e;args=1<=arguments.length?__slice.call(arguments,0):[];try{return $.localStorage.apply($,args)}catch(_error){return e=_error,console.error("localStorage exception",e),null}})}.call(this),define("modules/localStorage",function(){}),function(){define("utils/underscore",["libs"],function(){return angular.module("underscore",[]).factory("_",function(){return window._})})}.call(this),function(){var __slice=[].slice;define("base",["libs","modules/recursionHelper","modules/errorCatcher","modules/localStorage","utils/underscore"],function(){var App,sl_debugging,_ref,_ref1;return App=angular.module("SharelatexApp",["ui.bootstrap","autocomplete","RecursionHelper","ng-context-menu","underscore","ngSanitize","ipCookie","mvdSixpack","ErrorCatcher","localStorage","ngTagsInput"]).config(function(sixpackProvider){return sixpackProvider.setOptions({debug:!1,baseUrl:window.sharelatex.sixpackDomain,client_id:window.user_id})}),sl_debugging=null!=(null!=(_ref=window.location)&&null!=(_ref1=_ref.search)?_ref1.match(/debug=true/):void 0),window.sl_console={log:function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],sl_debugging?console.log.apply(console,args):void 0}},App})}.call(this),function(){var __indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};define("main/project-list/project-list",["base"],function(App){return App.controller("ProjectPageController",function($scope,$modal,$q,$window,queuedHttp,event_tracking,$timeout,localStorage){var MAX_PROJECT_NAME_LENGTH,markTagAsSelected,project,project_id,projectsById,recalculateProjectListHeight,storedUIOpts,tag,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2;for($scope.projects=window.data.projects,$scope.tags=window.data.tags,$scope.notifications=window.data.notifications,$scope.allSelected=!1,$scope.selectedProjects=[],$scope.filter="all",$scope.predicate="lastUpdated",$scope.nUntagged=0,$scope.reverse=!0,$scope.searchText={value:""},$timeout(function(){return recalculateProjectListHeight()},10),$scope.$watch(function(){return $scope.projects.filter(function(project){return null==project.tags||0===project.tags.length}).length},function(newVal){return $scope.nUntagged=newVal}),storedUIOpts=JSON.parse(localStorage("project_list")),recalculateProjectListHeight=function(){var bottomOffset,height,sideBarHeight,topOffset,_ref,_ref1;return topOffset=null!=(_ref=$(".project-list-card"))&&null!=(_ref1=_ref.offset())?_ref1.top:void 0,bottomOffset=$("footer").outerHeight()+25,sideBarHeight=$("aside").height()-56,height=$window.innerHeight-topOffset-bottomOffset,sideBarHeight>height&&(height=Math.min(sideBarHeight,$window.innerHeight-topOffset-25)),$scope.projectListHeight=height},angular.element($window).bind("resize",function(){return recalculateProjectListHeight(),$scope.$apply()}),projectsById={},_ref=$scope.projects,_i=0,_len=_ref.length;_len>_i;_i++)project=_ref[_i],projectsById[project.id]=project;for(_ref1=$scope.tags,_j=0,_len1=_ref1.length;_len1>_j;_j++)for(tag=_ref1[_j],_ref2=tag.project_ids||[],_k=0,_len2=_ref2.length;_len2>_k;_k++)project_id=_ref2[_k],project=projectsById[project_id],null!=project&&(project.tags||(project.tags=[]),project.tags.push(tag));return markTagAsSelected=function(id){var _l,_len3,_ref3,_results;for(_ref3=$scope.tags,_results=[],_l=0,_len3=_ref3.length;_len3>_l;_l++)tag=_ref3[_l],tag._id===id?_results.push(tag.selected=!0):_results.push(tag.selected=!1);return _results},$scope.changePredicate=function(newPredicate){return $scope.predicate===newPredicate&&($scope.reverse=!$scope.reverse),$scope.predicate=newPredicate},$scope.getSortIconClass=function(column){return column===$scope.predicate&&$scope.reverse?"fa-caret-down":column!==$scope.predicate||$scope.reverse?"":"fa-caret-up"},$scope.searchProjects=function(){return event_tracking.send("project-list-page-interaction","project-search","keydown"),$scope.updateVisibleProjects()},$scope.clearSearchText=function(){return $scope.searchText.value="",$scope.filter="all",$scope.$emit("search:clear"),$scope.updateVisibleProjects()},$scope.setFilter=function(filter){return $scope.filter=filter,$scope.updateVisibleProjects()},$scope.updateSelectedProjects=function(){return $scope.selectedProjects=$scope.projects.filter(function(project){return project.selected})},$scope.getSelectedProjects=function(){return $scope.selectedProjects},$scope.getSelectedProjectIds=function(){return $scope.selectedProjects.map(function(project){return project.id})},$scope.getFirstSelectedProject=function(){return $scope.selectedProjects[0]},$scope.updateVisibleProjects=function(){var selectedTag,visible,_l,_len3,_ref3,_ref4,_ref5;for($scope.visibleProjects=[],selectedTag=$scope.getSelectedTag(),_ref3=$scope.projects,_l=0,_len3=_ref3.length;_len3>_l;_l++)project=_ref3[_l],visible=!0,null!=$scope.searchText.value&&""!==$scope.searchText.value&&-1===project.name.toLowerCase().indexOf($scope.searchText.value.toLowerCase())&&(visible=!1),"tag"===$scope.filter&&null!=selectedTag&&(_ref4=project.id,__indexOf.call(selectedTag.project_ids,_ref4)<0)&&(visible=!1),"untagged"===$scope.filter&&(null!=(_ref5=project.tags)?_ref5.length:void 0)>0&&(visible=!1),"shared"===$scope.filter&&"owner"===project.accessLevel&&(visible=!1),"owned"===$scope.filter&&"owner"!==project.accessLevel&&(visible=!1),"archived"===$scope.filter?project.archived||(visible=!1):project.archived&&(visible=!1),visible?$scope.visibleProjects.push(project):project.selected=!1;return localStorage("project_list",JSON.stringify({filter:$scope.filter,selectedTagId:null!=selectedTag?selectedTag._id:void 0})),$scope.updateSelectedProjects()},$scope.getSelectedTag=function(){var _l,_len3,_ref3;for(_ref3=$scope.tags,_l=0,_len3=_ref3.length;_len3>_l;_l++)if(tag=_ref3[_l],tag.selected)return tag;return null},$scope._removeProjectIdsFromTagArray=function(tag,remove_project_ids){var remaining_project_ids,removed_project_ids,_l,_len3,_ref3;for(remaining_project_ids=[],removed_project_ids=[],_ref3=tag.project_ids,_l=0,_len3=_ref3.length;_len3>_l;_l++)project_id=_ref3[_l],__indexOf.call(remove_project_ids,project_id)<0?remaining_project_ids.push(project_id):removed_project_ids.push(project_id);return tag.project_ids=remaining_project_ids,removed_project_ids},$scope._removeProjectFromList=function(project){var index;return index=$scope.projects.indexOf(project),index>-1?$scope.projects.splice(index,1):void 0},$scope.removeSelectedProjectsFromTag=function(tag){var index,remaining_tags,removed_project_ids,selected_project_ids,selected_projects,_l,_len3,_len4,_m;for(tag.showWhenEmpty=!0,selected_project_ids=$scope.getSelectedProjectIds(),selected_projects=$scope.getSelectedProjects(),removed_project_ids=$scope._removeProjectIdsFromTagArray(tag,selected_project_ids),remaining_tags=[],_l=0,_len3=selected_projects.length;_len3>_l;_l++)project=selected_projects[_l],project.tags||(project.tags=[]),index=project.tags.indexOf(tag),index>-1&&project.tags.splice(index,1);for(_m=0,_len4=removed_project_ids.length;_len4>_m;_m++)project_id=removed_project_ids[_m],queuedHttp({method:"DELETE",url:"/tag/"+tag._id+"/project/"+project_id,headers:{"X-CSRF-Token":window.csrfToken}});return $scope.updateVisibleProjects()},$scope.removeProjectFromTag=function(project,tag){var index;return tag.showWhenEmpty=!0,project.tags||(project.tags=[]),index=project.tags.indexOf(tag),index>-1?($scope._removeProjectIdsFromTagArray(tag,[project.id]),project.tags.splice(index,1),queuedHttp({method:"DELETE",url:"/tag/"+tag._id+"/project/"+project.id,headers:{"X-CSRF-Token":window.csrfToken}}),$scope.updateVisibleProjects()):void 0},$scope.addSelectedProjectsToTag=function(tag){var added_project_ids,selected_projects,_l,_len3,_len4,_len5,_m,_n,_ref3,_results;for(selected_projects=$scope.getSelectedProjects(),event_tracking.send("project-list-page-interaction","project action","addSelectedProjectsToTag"),added_project_ids=[],_ref3=$scope.getSelectedProjectIds(),_l=0,_len3=_ref3.length;_len3>_l;_l++)project_id=_ref3[_l],__indexOf.call(tag.project_ids,project_id)<0&&(tag.project_ids.push(project_id),added_project_ids.push(project_id));for(_m=0,_len4=selected_projects.length;_len4>_m;_m++)project=selected_projects[_m],project.tags||(project.tags=[]),__indexOf.call(project.tags,tag)<0&&project.tags.push(tag);for(_results=[],_n=0,_len5=added_project_ids.length;_len5>_n;_n++)project_id=added_project_ids[_n],_results.push(queuedHttp.post("/tag/"+tag._id+"/project/"+project_id,{_csrf:window.csrfToken}));return _results},$scope.createTag=function(name){return tag},$scope.openNewTagModal=function(e){var modalInstance;return modalInstance=$modal.open({templateUrl:"newTagModalTemplate",controller:"NewTagModalController"}),modalInstance.result.then(function(tag){return $scope.tags.push(tag),$scope.addSelectedProjectsToTag(tag)})},$scope.createProject=function(name,template){var deferred;return null==template&&(template="none"),deferred=$q.defer(),queuedHttp.post("/project/new",{_csrf:window.csrfToken,projectName:name,template:template}).success(function(data,status,headers,config){return $scope.projects.push({name:name,_id:data.project_id,accessLevel:"owner"}),$scope.updateVisibleProjects(),deferred.resolve(data.project_id)}).error(function(data,status,headers,config){return deferred.reject()}),deferred.promise},$scope.openCreateProjectModal=function(template){var modalInstance;return null==template&&(template="none"),event_tracking.send("project-list-page-interaction","new-project",template),modalInstance=$modal.open({templateUrl:"newProjectModalTemplate",controller:"NewProjectModalController",resolve:{template:function(){return template}},scope:$scope}),modalInstance.result.then(function(project_id){return window.location="/project/"+project_id})},MAX_PROJECT_NAME_LENGTH=150,$scope.renameProject=function(project,newName){return null==newName||0===newName.length||newName.length>MAX_PROJECT_NAME_LENGTH?void 0:(project.name=newName,queuedHttp.post("/project/"+project.id+"/rename",{newProjectName:project.name,_csrf:window.csrfToken}))},$scope.openRenameProjectModal=function(){var modalInstance;return project=$scope.getFirstSelectedProject(),null!=project&&"owner"===project.accessLevel?(event_tracking.send("project-list-page-interaction","project action","Rename"),modalInstance=$modal.open({templateUrl:"renameProjectModalTemplate",controller:"RenameProjectModalController",resolve:{projectName:function(){return project.name}}}),modalInstance.result.then(function(newName){return $scope.renameProject(project,newName)})):void 0},$scope.cloneProject=function(project,cloneName){var deferred;return deferred=$q.defer(),event_tracking.send("project-list-page-interaction","project action","Clone"),queuedHttp.post("/project/"+project.id+"/clone",{_csrf:window.csrfToken,projectName:cloneName}).success(function(data,status,headers,config){return $scope.projects.push({name:cloneName,id:data.project_id,accessLevel:"owner"}),$scope.updateVisibleProjects(),deferred.resolve(data.project_id)}).error(function(data,status,headers,config){return deferred.reject()}),deferred.promise},$scope.openCloneProjectModal=function(){var modalInstance;return project=$scope.getFirstSelectedProject(),null!=project?modalInstance=$modal.open({templateUrl:"cloneProjectModalTemplate",controller:"CloneProjectModalController",resolve:{project:function(){return project}},scope:$scope}):void 0},$scope.openArchiveProjectsModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"deleteProjectsModalTemplate",controller:"DeleteProjectsModalController",resolve:{projects:function(){return $scope.getSelectedProjects()}}}),event_tracking.send("project-list-page-interaction","project action","Delete"),modalInstance.result.then(function(){return $scope.archiveOrLeaveSelectedProjects()})},$scope.archiveOrLeaveSelectedProjects=function(){var selected_project_ids,selected_projects,_l,_len3,_len4,_m,_ref3;for(selected_projects=$scope.getSelectedProjects(),selected_project_ids=$scope.getSelectedProjectIds(),_ref3=$scope.tags,_l=0,_len3=_ref3.length;_len3>_l;_l++)tag=_ref3[_l],$scope._removeProjectIdsFromTagArray(tag,selected_project_ids);for(_m=0,_len4=selected_projects.length;_len4>_m;_m++)project=selected_projects[_m],project.tags=[],"owner"===project.accessLevel?(project.archived=!0,queuedHttp({method:"DELETE",url:"/project/"+project.id,headers:{"X-CSRF-Token":window.csrfToken}})):($scope._removeProjectFromList(project),queuedHttp({method:"POST",url:"/project/"+project.id+"/leave",headers:{"X-CSRF-Token":window.csrfToken}}));return $scope.updateVisibleProjects()},$scope.openDeleteProjectsModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"deleteProjectsModalTemplate",controller:"DeleteProjectsModalController",resolve:{projects:function(){return $scope.getSelectedProjects()}}}),modalInstance.result.then(function(){return $scope.deleteSelectedProjects()})},$scope.deleteSelectedProjects=function(){var selected_project_ids,selected_projects,_l,_len3,_len4,_len5,_m,_n,_ref3;for(selected_projects=$scope.getSelectedProjects(),selected_project_ids=$scope.getSelectedProjectIds(),_l=0,_len3=selected_projects.length;_len3>_l;_l++)project=selected_projects[_l],$scope._removeProjectFromList(project);for(_ref3=$scope.tags,_m=0,_len4=_ref3.length;_len4>_m;_m++)tag=_ref3[_m],$scope._removeProjectIdsFromTagArray(tag,selected_project_ids);for(_n=0,_len5=selected_project_ids.length;_len5>_n;_n++)project_id=selected_project_ids[_n],queuedHttp({method:"DELETE",url:"/project/"+project_id+"?forever=true",headers:{"X-CSRF-Token":window.csrfToken}});return $scope.updateVisibleProjects()},$scope.restoreSelectedProjects=function(){var selected_project_ids,selected_projects,_l,_len3,_len4,_m;for(selected_projects=$scope.getSelectedProjects(),selected_project_ids=$scope.getSelectedProjectIds(),_l=0,_len3=selected_projects.length;_len3>_l;_l++)project=selected_projects[_l],project.archived=!1;for(_m=0,_len4=selected_project_ids.length;_len4>_m;_m++)project_id=selected_project_ids[_m],queuedHttp({method:"POST",url:"/project/"+project_id+"/restore",headers:{"X-CSRF-Token":window.csrfToken}});return $scope.updateVisibleProjects()},$scope.openUploadProjectModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"uploadProjectModalTemplate",controller:"UploadProjectModalController"})},$scope.downloadSelectedProjects=function(){var path,selected_project_ids;return selected_project_ids=$scope.getSelectedProjectIds(),event_tracking.send("project-list-page-interaction","project action","Download Zip"),path=selected_project_ids.length>1?"/project/download/zip?project_ids="+selected_project_ids.join(","):"/project/"+selected_project_ids[0]+"/download/zip",window.location=path},null!=(null!=storedUIOpts?storedUIOpts.filter:void 0)?("tag"===storedUIOpts.filter&&null!=storedUIOpts.selectedTagId&&markTagAsSelected(storedUIOpts.selectedTagId),$scope.setFilter(storedUIOpts.filter)):$scope.updateVisibleProjects()}),App.controller("ProjectListItemController",function($scope){return $scope.ownerName=function(){return"owner"===$scope.project.accessLevel?"You":null!=$scope.project.owner?""+$scope.project.owner.first_name+" "+$scope.project.owner.last_name:"?"},$scope.$watch("project.selected",function(value){return null!=value?$scope.updateSelectedProjects():void 0})})})}.call(this),function(){define("main/project-list/modal-controllers",["base"],function(App){return App.controller("RenameProjectModalController",function($scope,$modalInstance,$timeout,projectName){return $scope.inputs={projectName:projectName},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),$scope.rename=function(){return $modalInstance.close($scope.inputs.projectName)},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("CloneProjectModalController",function($scope,$modalInstance,$timeout,project){return $scope.inputs={projectName:project.name+" (Copy)"},$scope.state={inflight:!1},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),$scope.clone=function(){return $scope.state.inflight=!0,$scope.cloneProject(project,$scope.inputs.projectName).then(function(project_id){return $scope.state.inflight=!1,$modalInstance.close(project_id)})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("NewProjectModalController",function($scope,$modalInstance,$timeout,template){return $scope.inputs={projectName:""},$scope.state={inflight:!1},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),$scope.create=function(){return $scope.state.inflight=!0,$scope.createProject($scope.inputs.projectName,template).then(function(project_id){return $scope.state.inflight=!1,$modalInstance.close(project_id)})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("DeleteProjectsModalController",function($scope,$modalInstance,$timeout,projects){return $scope.projectsToDelete=projects.filter(function(project){return"owner"===project.accessLevel}),$scope.projectsToLeave=projects.filter(function(project){return"owner"!==project.accessLevel}),$scope.projectsToLeave.length>0&&$scope.projectsToDelete.length>0?$scope.action="delete-and-leave":0===$scope.projectsToLeave.length&&$scope.projectsToDelete.length>0?$scope.action="delete":$scope.action="leave",$scope["delete"]=function(){return $modalInstance.close()},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("UploadProjectModalController",function($scope,$modalInstance,$timeout){return $scope.cancel=function(){return $modalInstance.dismiss("cancel")},$scope.onComplete=function(error,name,response){return null!=response.project_id?window.location="/project/"+response.project_id:void 0}})})}.call(this),function(){var __indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};define("main/project-list/tag-controllers",["base"],function(App){return App.controller("TagListController",function($scope,$modal){return $scope.filterProjects=function(filter){return null==filter&&(filter="all"),$scope._clearTags(),$scope.setFilter(filter)},$scope._clearTags=function(){var tag,_i,_len,_ref,_results;for(_ref=$scope.tags,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)tag=_ref[_i],_results.push(tag.selected=!1);return _results},$scope.selectTag=function(tag){return $scope._clearTags(),tag.selected=!0,$scope.setFilter("tag")},$scope.selectUntagged=function(){return $scope._clearTags(),$scope.setFilter("untagged")},$scope.deleteTag=function(tag){var modalInstance;return modalInstance=$modal.open({templateUrl:"deleteTagModalTemplate",controller:"DeleteTagModalController",resolve:{tag:function(){return tag}}}),modalInstance.result.then(function(){var index,project,_i,_len,_ref;for(_ref=$scope.projects,_i=0,_len=_ref.length;_len>_i;_i++)project=_ref[_i],project.tags||(project.tags=[]),index=project.tags.indexOf(tag),index>-1&&project.tags.splice(index,1);return $scope.tags=$scope.tags.filter(function(t){return t!==tag})})},$scope.renameTag=function(tag){var modalInstance;return modalInstance=$modal.open({templateUrl:"renameTagModalTemplate",controller:"RenameTagModalController",resolve:{tag:function(){return tag},existing_tags:function(){return $scope.tags}}}),modalInstance.result.then(function(new_name){return tag.name=new_name})}}),App.controller("TagDropdownItemController",function($scope){return $scope.recalculateProjectsInTag=function(){var partialSelection,project_id,_i,_len,_ref;for($scope.areSelectedProjectsInTag=!1,_ref=$scope.getSelectedProjectIds(),_i=0,_len=_ref.length;_len>_i;_i++)project_id=_ref[_i],__indexOf.call($scope.tag.project_ids,project_id)>=0?$scope.areSelectedProjectsInTag=!0:partialSelection=!0;return $scope.areSelectedProjectsInTag&&partialSelection?$scope.areSelectedProjectsInTag="partial":void 0},$scope.addOrRemoveProjectsFromTag=function(){return $scope.areSelectedProjectsInTag===!0?($scope.removeSelectedProjectsFromTag($scope.tag),$scope.areSelectedProjectsInTag=!1):$scope.areSelectedProjectsInTag===!1||"partial"===$scope.areSelectedProjectsInTag?($scope.addSelectedProjectsToTag($scope.tag),$scope.areSelectedProjectsInTag=!0):void 0},$scope.$watch("selectedProjects",function(){return $scope.recalculateProjectsInTag()}),$scope.recalculateProjectsInTag()}),App.controller("NewTagModalController",function($scope,$modalInstance,$timeout,$http){return $scope.inputs={newTagName:""},$scope.state={inflight:!1,error:!1},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),$scope.create=function(){var name;return name=$scope.inputs.newTagName,$scope.state.inflight=!0,$scope.state.error=!1,$http.post("/tag",{_csrf:window.csrfToken,name:name}).success(function(data,status,headers,config){return $scope.state.inflight=!1,$modalInstance.close(data)}).error(function(){return $scope.state.inflight=!1,$scope.state.error=!0})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("RenameTagModalController",function($scope,$modalInstance,$timeout,$http,tag,existing_tags){return $scope.inputs={tagName:tag.name},$scope.state={inflight:!1,error:!1},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),$scope.rename=function(){var name;return name=$scope.inputs.tagName,$scope.state.inflight=!0,$scope.state.error=!1,$http.post("/tag/"+tag._id+"/rename",{_csrf:window.csrfToken,name:name}).success(function(){return $scope.state.inflight=!1,$modalInstance.close(name)}).error(function(){return $scope.state.inflight=!1,$scope.state.error=!0})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("DeleteTagModalController",function($scope,$modalInstance,$http,tag){return $scope.tag=tag,$scope.state={inflight:!1,error:!1},$scope["delete"]=function(){return $scope.state.inflight=!0,$scope.state.error=!1,$http({method:"DELETE",url:"/tag/"+tag._id,headers:{"X-CSRF-Token":window.csrfToken}}).success(function(){return $scope.state.inflight=!1,$modalInstance.close()}).error(function(){return $scope.state.inflight=!1,$scope.state.error=!0})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}})})}.call(this),function(){define("main/project-list/notifications-controller",["base"],function(App){return App.controller("NotificationsController",function($scope,$http){var notification,_i,_len,_ref;for(_ref=$scope.notifications,_i=0,_len=_ref.length;_len>_i;_i++)notification=_ref[_i],notification.hide=!1;return $scope.dismiss=function(notification){return $http({url:"/notifications/"+notification._id,method:"DELETE",headers:{"X-Csrf-Token":window.csrfToken}}).success(function(data){return notification.hide=!0})}}),App.controller("ProjectInviteNotificationController",function($scope,$http){return $scope.projectName=$scope.notification.messageOpts.projectName,$scope.userName=$scope.notification.messageOpts.userName,$scope.accept=function(){return $scope.notification.inflight=!0,$http({url:"/project/"+$scope.notification.messageOpts.projectId+"/invite/token/"+$scope.notification.messageOpts.token+"/accept",method:"POST",headers:{"X-Csrf-Token":window.csrfToken,"X-Requested-With":"XMLHttpRequest"}}).success(function(){return $scope.notification.inflight=!1,$scope.notification.accepted=!0}).error(function(){return $scope.notification.inflight=!1,$scope.notification.error=!0})}})})}.call(this),function(){define("main/project-list/left-hand-menu-promo-controller",["base"],function(App){return App.controller("LeftHandMenuPromoController",function($scope){return $scope.hasProjects=window.data.projects.length>0,$scope.userHasNoSubscription=window.userHasNoSubscription})})}.call(this),function(){var __slice=[].slice;define("services/queued-http",["base"],function(App){return App.factory("queuedHttp",function($http,$q){var inflight,pendingRequests,processPendingRequests,queuedHttp;return pendingRequests=[],inflight=!1,processPendingRequests=function(){var doRequest;if(!inflight)return doRequest=pendingRequests.shift(),null!=doRequest?(inflight=!0,doRequest().success(function(){return inflight=!1,processPendingRequests()}).error(function(){return inflight=!1,processPendingRequests()})):void 0},queuedHttp=function(){var args,deferred,doRequest,promise;return args=1<=arguments.length?__slice.call(arguments,0):[],deferred=$q.defer(),promise=deferred.promise,promise.success=function(callback){return promise.then(callback),promise},promise.error=function(callback){return promise["catch"](callback),promise},doRequest=function(){return $http.apply(null,args).success(function(){var successArgs;return successArgs=1<=arguments.length?__slice.call(arguments,0):[],deferred.resolve.apply(deferred,successArgs)}).error(function(){var errorArgs;return errorArgs=1<=arguments.length?__slice.call(arguments,0):[],deferred.reject.apply(deferred,errorArgs)})},pendingRequests.push(doRequest),processPendingRequests(),promise},queuedHttp.post=function(url,data){return queuedHttp({method:"POST",url:url,data:data})},queuedHttp})})}.call(this),function(){define("main/project-list/index",["main/project-list/project-list","main/project-list/modal-controllers","main/project-list/tag-controllers","main/project-list/notifications-controller","main/project-list/left-hand-menu-promo-controller","services/queued-http"],function(){})}.call(this),function(){define("main/user-details",["base","libs/algolia-2.5.2"],function(App,algolia){return App.factory("Institutions",function(){return new AlgoliaSearch(window.algolia.institutions.app_id,window.algolia.institutions.api_key).initIndex("institutions")}),App.controller("UserProfileController",function($scope,$modal,$http){return $scope.institutions=[],$http.get("/user/personal_info").success(function(data){return $scope.userInfoForm={first_name:data.first_name||"",last_name:data.last_name||"",role:data.role||"",institution:data.institution||"",_csrf:window.csrfToken}}),$scope.showForm=function(){return GrooveWidget.toggle(),$scope.formVisable=!0},$scope.getPercentComplete=function(){var results;return results=_.filter($scope.userInfoForm,function(value){return null==value||0!==(null!=value?value.length:void 0)}),20*results.length},$scope.$watch("userInfoForm",function(value){return null!=value?$scope.percentComplete=$scope.getPercentComplete():void 0},!0),$scope.openUserProfileModal=function(){return $modal.open({templateUrl:"userProfileModalTemplate",controller:"UserProfileModalController",scope:$scope})}}),App.controller("UserProfileModalController",function($scope,$modalInstance,$http,Institutions){var sendUpdate;return $scope.roles=["Student","Post-graduate student","Post-doctoral researcher","Lecturer","Professor"],$modalInstance.result["finally"](function(){return sendUpdate()}),sendUpdate=function(){var request;return request=$http.post("/user/settings",$scope.userInfoForm),request.success(function(data,status){}),request.error(function(data,status){return console.log("the request failed")})},$scope.updateInstitutionsList=function(inputVal){var query;return query=$scope.userInfoForm.institution,(null!=query?query.length:void 0)<=3?void 0:Institutions.search($scope.userInfoForm.institution,function(err,response){return $scope.institutions=_.map(response.hits,function(institution){return""+institution.name+" ("+institution.domain+")"})})},$scope.done=function(){return $modalInstance.close()}})})}.call(this),function(){define("main/account-settings",["base"],function(App){return App.controller("AccountSettingsController",["$scope","$http","$modal",function($scope,$http,$modal){return $scope.subscribed=!0,$scope.unsubscribe=function(){return $scope.unsubscribing=!0,$http({method:"DELETE",url:"/user/newsletter/unsubscribe",headers:{"X-CSRF-Token":window.csrfToken}}).success(function(){return $scope.unsubscribing=!1,$scope.subscribed=!1}).error(function(){return $scope.unsubscribing=!0})},$scope.deleteAccount=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"deleteAccountModalTemplate",controller:"DeleteAccountModalController",scope:$scope})}}]),App.controller("DeleteAccountModalController",["$scope","$modalInstance","$timeout","$http",function($scope,$modalInstance,$timeout,$http){return $scope.state={isValid:!1,deleteText:"",password:"",inflight:!1,error:!1,invalidCredentials:!1},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},700)}),$scope.checkValidation=function(){return $scope.state.isValid=$scope.state.deleteText===$scope.email&&$scope.state.password.length>0},$scope["delete"]=function(){return $scope.state.inflight=!0,$scope.state.error=!1,$scope.state.invalidCredentials=!1,$http({method:"POST",url:"/user/delete",headers:{"X-CSRF-Token":window.csrfToken,"Content-Type":"application/json"},data:{password:$scope.state.password},disableAutoLoginRedirect:!0}).success(function(){return $modalInstance.close(),$scope.state.inflight=!1,$scope.state.error=!1,$scope.state.invalidCredentials=!1,setTimeout(function(){return window.location="/login"},1e3)}).error(function(data,status){return $scope.state.inflight=!1,403===status?$scope.state.invalidCredentials=!0:$scope.state.error=!0})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}])})}.call(this),function(){define("main/clear-sessions",["base"],function(App){return App.controller("ClearSessionsController",["$scope","$http",function($scope,$http){return $scope.state={otherSessions:window.otherSessions,error:!1,success:!1},$scope.clearSessions=function(){return console.log(">> clearing all sessions"),$http({method:"POST",url:"/user/sessions/clear",headers:{"X-CSRF-Token":window.csrfToken}}).success(function(){return $scope.state.otherSessions=[],$scope.state.error=!1,$scope.state.success=!0}).error(function(){return $scope.state.error=!0})}}])})}.call(this),function(){define("main/account-upgrade",["base"],function(App){return App.controller("FreeTrialModalController",function($scope,abTestManager,sixpack,event_tracking){return $scope.buttonClass="btn-primary",$scope.startFreeTrial=function(source,couponCode){var go,plan,w;
return plan="collaborator_free_trial_7_days",w=window.open(),go=function(){var url;switch("function"==typeof ga&&ga("send","event","subscription-funnel","upgraded-free-trial",source),url="/user/subscription/new?planCode="+plan+"&ssp=true",null!=couponCode&&(url=""+url+"&cc="+couponCode),$scope.startedFreeTrial=!0,source){case"dropbox":sixpack.participate("teaser-dropbox-text",["default","dropbox-focused"],function(variant){return event_tracking.sendMB("subscription-start-trial",{source:source,plan:plan,variant:variant})});break;case"history":sixpack.participate("teaser-history",["default","focused"],function(variant){return event_tracking.sendMB("subscription-start-trial",{source:source,plan:plan,variant:variant})});break;default:event_tracking.sendMB("subscription-start-trial",{source:source,plan:plan})}return w.location=url},$scope.shouldABTestPlans?sixpack.participate("plans-1610",["default","heron","ibis"],function(chosenVariation,rawResponse){return("heron"===chosenVariation||"ibis"===chosenVariation)&&(plan="collaborator_"+chosenVariation),go()}):go()}})})}.call(this),function(){function require(path,parent,orig){var resolved=require.resolve(path);if(null==resolved){orig=orig||path,parent=parent||"root";var err=new Error('Failed to require "'+orig+'" from "'+parent+'"');throw err.path=orig,err.parent=parent,err.require=!0,err}var module=require.modules[resolved];if(!module._resolving&&!module.exports){var mod={};mod.exports={},mod.client=mod.component=!0,module._resolving=!0,module.call(this,mod.exports,require.relative(resolved),mod),delete module._resolving,module.exports=mod.exports}return module.exports}require.modules={},require.aliases={},require.resolve=function(path){"/"===path.charAt(0)&&(path=path.slice(1));for(var paths=[path,path+".js",path+".json",path+"/index.js",path+"/index.json"],i=0;i<paths.length;i++){var path=paths[i];if(require.modules.hasOwnProperty(path))return path;if(require.aliases.hasOwnProperty(path))return require.aliases[path]}},require.normalize=function(curr,path){var segs=[];if("."!=path.charAt(0))return path;curr=curr.split("/"),path=path.split("/");for(var i=0;i<path.length;++i)".."==path[i]?curr.pop():"."!=path[i]&&""!=path[i]&&segs.push(path[i]);return curr.concat(segs).join("/")},require.register=function(path,definition){require.modules[path]=definition},require.alias=function(from,to){if(!require.modules.hasOwnProperty(from))throw new Error('Failed to alias "'+from+'", it does not exist');require.aliases[to]=from},require.relative=function(parent){function lastIndexOf(arr,obj){for(var i=arr.length;i--;)if(arr[i]===obj)return i;return-1}function localRequire(path){var resolved=localRequire.resolve(path);return require(resolved,parent,path)}var p=require.normalize(parent,"..");return localRequire.resolve=function(path){var c=path.charAt(0);if("/"==c)return path.slice(1);if("."==c)return require.normalize(p,path);var segs=parent.split("/"),i=lastIndexOf(segs,"deps")+1;return i||(i=0),path=segs.slice(0,i+1).join("/")+"/deps/"+path},localRequire.exists=function(path){return require.modules.hasOwnProperty(localRequire.resolve(path))},localRequire},require.register("visionmedia-node-querystring/index.js",function(exports,require,module){function promote(parent,key){if(0==parent[key].length)return parent[key]={};var t={};for(var i in parent[key])hasOwnProperty.call(parent[key],i)&&(t[i]=parent[key][i]);return parent[key]=t,t}function parse(parts,parent,key,val){var part=parts.shift();if(!Object.getOwnPropertyDescriptor(Object.prototype,key))if(part){var obj=parent[key]=parent[key]||[];"]"==part?isArray(obj)?""!=val&&obj.push(val):"object"==typeof obj?obj[objectKeys(obj).length]=val:obj=parent[key]=[parent[key],val]:~indexOf(part,"]")?(part=part.substr(0,part.length-1),!isint.test(part)&&isArray(obj)&&(obj=promote(parent,key)),parse(parts,obj,part,val)):(!isint.test(part)&&isArray(obj)&&(obj=promote(parent,key)),parse(parts,obj,part,val))}else isArray(parent[key])?parent[key].push(val):"object"==typeof parent[key]?parent[key]=val:"undefined"==typeof parent[key]?parent[key]=val:parent[key]=[parent[key],val]}function merge(parent,key,val){if(~indexOf(key,"]")){var parts=key.split("[");parts.length;parse(parts,parent,"base",val)}else{if(!isint.test(key)&&isArray(parent.base)){var t={};for(var k in parent.base)t[k]=parent.base[k];parent.base=t}set(parent.base,key,val)}return parent}function compact(obj){if("object"!=typeof obj)return obj;if(isArray(obj)){var ret=[];for(var i in obj)hasOwnProperty.call(obj,i)&&ret.push(obj[i]);return ret}for(var key in obj)obj[key]=compact(obj[key]);return obj}function parseObject(obj){var ret={base:{}};return forEach(objectKeys(obj),function(name){merge(ret,name,obj[name])}),compact(ret.base)}function parseString(str){var ret=reduce(String(str).split("&"),function(ret,pair){var eql=indexOf(pair,"="),brace=lastBraceInKey(pair),key=pair.substr(0,brace||eql),val=pair.substr(brace||eql,pair.length),val=val.substr(indexOf(val,"=")+1,val.length);return""==key&&(key=pair,val=""),""==key?ret:merge(ret,decode(key),decode(val))},{base:{}}).base;return compact(ret)}function stringifyString(str,prefix){if(!prefix)throw new TypeError("stringify expects an object");return prefix+"="+encodeURIComponent(str)}function stringifyArray(arr,prefix){var ret=[];if(!prefix)throw new TypeError("stringify expects an object");for(var i=0;i<arr.length;i++)ret.push(stringify(arr[i],prefix+"["+i+"]"));return ret.join("&")}function stringifyObject(obj,prefix){for(var key,ret=[],keys=objectKeys(obj),i=0,len=keys.length;len>i;++i)key=keys[i],""!=key&&(null==obj[key]?ret.push(encodeURIComponent(key)+"="):ret.push(stringify(obj[key],prefix?prefix+"["+encodeURIComponent(key)+"]":encodeURIComponent(key))));return ret.join("&")}function set(obj,key,val){var v=obj[key];Object.getOwnPropertyDescriptor(Object.prototype,key)||(void 0===v?obj[key]=val:isArray(v)?v.push(val):obj[key]=[v,val])}function lastBraceInKey(str){for(var brace,c,len=str.length,i=0;len>i;++i)if(c=str[i],"]"==c&&(brace=!1),"["==c&&(brace=!0),"="==c&&!brace)return i}function decode(str){try{return decodeURIComponent(str.replace(/\+/g," "))}catch(err){return str}}var toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,indexOf="function"==typeof Array.prototype.indexOf?function(arr,el){return arr.indexOf(el)}:function(arr,el){for(var i=0;i<arr.length;i++)if(arr[i]===el)return i;return-1},isArray=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)},objectKeys=Object.keys||function(obj){var ret=[];for(var key in obj)obj.hasOwnProperty(key)&&ret.push(key);return ret},forEach="function"==typeof Array.prototype.forEach?function(arr,fn){return arr.forEach(fn)}:function(arr,fn){for(var i=0;i<arr.length;i++)fn(arr[i])},reduce=function(arr,fn,initial){if("function"==typeof arr.reduce)return arr.reduce(fn,initial);for(var res=initial,i=0;i<arr.length;i++)res=fn(res,arr[i]);return res},isint=/^[0-9]+$/;exports.parse=function(str){return null==str||""==str?{}:"object"==typeof str?parseObject(str):parseString(str)};var stringify=exports.stringify=function(obj,prefix){return isArray(obj)?stringifyArray(obj,prefix):"[object Object]"==toString.call(obj)?stringifyObject(obj,prefix):"string"==typeof obj?stringifyString(obj,prefix):prefix+"="+encodeURIComponent(String(obj))}}),require.register("component-emitter/index.js",function(exports,require,module){function Emitter(obj){return obj?mixin(obj):void 0}function mixin(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}module.exports=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks[event]=this._callbacks[event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){self.off(event,on),fn.apply(this,arguments)}var self=this;return this._callbacks=this._callbacks||{},on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks[event],this;for(var cb,i=0;i<callbacks.length;i++)if(cb=callbacks[i],cb===fn||cb.fn===fn){callbacks.splice(i,1);break}return this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;len>i;++i)callbacks[i].apply(this,args)}return this},Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks[event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}}),require.register("component-indexof/index.js",function(exports,require,module){module.exports=function(arr,obj){if(arr.indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}}),require.register("component-object/index.js",function(exports,require,module){var has=Object.prototype.hasOwnProperty;exports.keys=Object.keys||function(obj){var keys=[];for(var key in obj)has.call(obj,key)&&keys.push(key);return keys},exports.values=function(obj){var vals=[];for(var key in obj)has.call(obj,key)&&vals.push(obj[key]);return vals},exports.merge=function(a,b){for(var key in b)has.call(b,key)&&(a[key]=b[key]);return a},exports.length=function(obj){return exports.keys(obj).length},exports.isEmpty=function(obj){return 0==exports.length(obj)}}),require.register("component-event/index.js",function(exports,require,module){var bind=window.addEventListener?"addEventListener":"attachEvent",unbind=window.removeEventListener?"removeEventListener":"detachEvent",prefix="addEventListener"!==bind?"on":"";exports.bind=function(el,type,fn,capture){return el[bind](prefix+type,fn,capture||!1),fn},exports.unbind=function(el,type,fn,capture){return el[unbind](prefix+type,fn,capture||!1),fn}}),require.register("component-clone/index.js",function(exports,require,module){function clone(obj){switch(type(obj)){case"object":var copy={};for(var key in obj)obj.hasOwnProperty(key)&&(copy[key]=clone(obj[key]));return copy;case"array":for(var copy=new Array(obj.length),i=0,l=obj.length;l>i;i++)copy[i]=clone(obj[i]);return copy;case"regexp":var flags="";return flags+=obj.multiline?"m":"",flags+=obj.global?"g":"",flags+=obj.ignoreCase?"i":"",new RegExp(obj.source,flags);case"date":return new Date(obj.getTime());default:return obj}}var type;try{type=require("component-type")}catch(_){type=require("type")}module.exports=clone}),require.register("component-bind/index.js",function(exports,require,module){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn&&(fn=obj[fn]),"function"!=typeof fn)throw new Error("bind() requires a function");var args=[].slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}}),require.register("component-props/index.js",function(exports,require,module){function props(str){return str.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^\/]+)\//g,"").replace(globals,"").match(/[$a-zA-Z_]\w*/g)||[]}function map(str,props,fn){var re=/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^\/]+)\/|[a-zA-Z_]\w*/g;return str.replace(re,function(_){return"("==_[_.length-1]?fn(_):~props.indexOf(_)?fn(_):_})}function unique(arr){for(var ret=[],i=0;i<arr.length;i++)~ret.indexOf(arr[i])||ret.push(arr[i]);return ret}function prefixed(str){return function(_){return str+_}}var globals=/\b(this|Array|Date|Object|Math|JSON)\b/g;module.exports=function(str,fn){var p=unique(props(str));return fn&&"string"==typeof fn&&(fn=prefixed(fn)),fn?map(str,p,fn):p}}),require.register("component-to-function/index.js",function(exports,require,module){function toFunction(obj){switch({}.toString.call(obj)){case"[object Object]":return objectToFunction(obj);case"[object Function]":return obj;case"[object String]":return stringToFunction(obj);case"[object RegExp]":return regexpToFunction(obj);default:return defaultToFunction(obj)}}function defaultToFunction(val){return function(obj){return val===obj}}function regexpToFunction(re){return function(obj){return re.test(obj)}}function stringToFunction(str){return/^ *\W+/.test(str)?new Function("_","return _ "+str):new Function("_","return "+get(str))}function objectToFunction(obj){var match={};for(var key in obj)match[key]="string"==typeof obj[key]?defaultToFunction(obj[key]):toFunction(obj[key]);return function(val){if("object"!=typeof val)return!1;for(var key in match){if(!(key in val))return!1;if(!match[key](val[key]))return!1}return!0}}function get(str){var props=expr(str);if(!props.length)return"_."+str;for(var val,prop,i=0;prop=props[i];i++)val="_."+prop,val="('function' == typeof "+val+" ? "+val+"() : "+val+")",str=str.replace(new RegExp(prop,"g"),val);return str}var expr=require("props");module.exports=toFunction}),require.register("component-each/index.js",function(exports,require,module){function string(obj,fn,ctx){for(var i=0;i<obj.length;++i)fn.call(ctx,obj.charAt(i),i)}function object(obj,fn,ctx){for(var key in obj)has.call(obj,key)&&fn.call(ctx,key,obj[key])}function array(obj,fn,ctx){for(var i=0;i<obj.length;++i)fn.call(ctx,obj[i],i)}var type=require("type"),toFunction=require("to-function"),has=Object.prototype.hasOwnProperty;module.exports=function(obj,fn,ctx){switch(fn=toFunction(fn),ctx=ctx||this,type(obj)){case"array":return array(obj,fn,ctx);case"object":return"number"==typeof obj.length?array(obj,fn,ctx):object(obj,fn,ctx);case"string":return string(obj,fn,ctx)}}}),require.register("component-find/index.js",function(exports,require,module){function objectToFunction(obj){return function(o){for(var key in obj)if(o[key]!=obj[key])return!1;return!0}}var toFunction=require("to-function");module.exports=function(arr,fn){"function"!=typeof fn&&(fn=Object(fn)===fn?objectToFunction(fn):toFunction(fn));for(var i=0,len=arr.length;len>i;++i)if(fn(arr[i],i))return arr[i]}}),require.register("component-json/index.js",function(exports,require,module){module.exports="undefined"==typeof JSON?require("component-json-fallback"):JSON}),require.register("component-type/index.js",function(exports,require,module){var toString=Object.prototype.toString;module.exports=function(val){switch(toString.call(val)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}return null===val?"null":void 0===val?"undefined":val&&1===val.nodeType?"element":val===Object(val)?"object":typeof val}}),require.register("component-trim/index.js",function(exports,require,module){function trim(str){return str.trim?str.trim():str.replace(/^\s*|\s*$/g,"")}exports=module.exports=trim,exports.left=function(str){return str.trimLeft?str.trimLeft():str.replace(/^\s*/,"")},exports.right=function(str){return str.trimRight?str.trimRight():str.replace(/\s*$/,"")}}),require.register("component-map/index.js",function(exports,require,module){var toFunction=require("to-function");module.exports=function(arr,fn){var ret=[];fn=toFunction(fn);for(var i=0;i<arr.length;++i)ret.push(fn(arr[i],i));return ret}}),require.register("yields-merge/index.js",function(exports,require,module){module.exports=function(a,b){for(var k in b)a[k]=b[k];return a}}),require.register("learnboost-jsonp/index.js",function(exports,require,module){function noop(){}function jsonp(url,opts,fn){function cleanup(){script.parentNode.removeChild(script),window[id]=noop}"function"==typeof opts&&(fn=opts,opts={}),opts||(opts={});var script,timer,prefix=opts.prefix||"__jp",param=opts.param||"callback",timeout=null!=opts.timeout?opts.timeout:6e4,enc=encodeURIComponent,target=document.getElementsByTagName("script")[0]||document.head,id=prefix+count++;timeout&&(timer=setTimeout(function(){cleanup(),fn&&fn(new Error("Timeout"))},timeout)),window[id]=function(data){debug("jsonp got",data),timer&&clearTimeout(timer),cleanup(),fn&&fn(null,data)},url+=(~url.indexOf("?")?"&":"?")+param+"="+enc(id),url=url.replace("?&","?"),debug('jsonp req "%s"',url),script=document.createElement("script"),script.src=url,target.parentNode.insertBefore(script,target)}var debug=require("debug")("jsonp");module.exports=jsonp;var count=0}),require.register("visionmedia-debug/debug.js",function(exports,require,module){function debug(name){return debug.enabled(name)?function(fmt){fmt=coerce(fmt);var curr=new Date,ms=curr-(debug[name]||curr);debug[name]=curr,fmt=name+" "+fmt+" +"+debug.humanize(ms),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function coerce(val){return val instanceof Error?val.stack||val.message:val}module.exports=debug,debug.names=[],debug.skips=[],debug.enable=function(name){try{localStorage.debug=name}catch(e){}for(var split=(name||"").split(/[\s,]+/),len=split.length,i=0;len>i;i++)name=split[i].replace("*",".*?"),"-"===name[0]?debug.skips.push(new RegExp("^"+name.substr(1)+"$")):debug.names.push(new RegExp("^"+name+"$"))},debug.disable=function(){debug.enable("")},debug.humanize=function(ms){var sec=1e3,min=6e4,hour=60*min;return ms>=hour?(ms/hour).toFixed(1)+"h":ms>=min?(ms/min).toFixed(1)+"m":ms>=sec?(ms/sec|0)+"s":ms+"ms"},debug.enabled=function(name){for(var i=0,len=debug.skips.length;len>i;i++)if(debug.skips[i].test(name))return!1;for(var i=0,len=debug.names.length;len>i;i++)if(debug.names[i].test(name))return!0;return!1};try{window.localStorage&&debug.enable(localStorage.debug)}catch(e){}}),require.register("johntron-asap/asap.js",function(exports,require,module){"use strict";function flush(){for(;head.next;){head=head.next;var task=head.task;head.task=void 0;try{task()}catch(e){throw isNodeJS?(requestFlush(),e):e}}flushing=!1}function asap(task){isNodeJS&&process.domain&&(task=process.domain.bind(task)),tail=tail.next={task:task,next:null},flushing||(requestFlush(),flushing=!0)}var domain,head={task:void 0,next:null},tail=head,flushing=!1,requestFlush=void 0,hasSetImmediate="function"==typeof setImmediate;if("undefined"!=typeof global)var process=global.process;var isNodeJS=!!process&&"[object process]"==={}.toString.call(process);if(isNodeJS)requestFlush=function(){var currentDomain=process.domain;currentDomain&&(domain=domain||(1,require)("domain"),domain.active=process.domain=null),flushing&&hasSetImmediate?setImmediate(flush):process.nextTick(flush),currentDomain&&(domain.active=process.domain=currentDomain)};else if(hasSetImmediate)requestFlush=function(){setImmediate(flush)};else if("undefined"!=typeof MessageChannel){var channel=new MessageChannel;channel.port1.onmessage=function(){requestFlush=requestPortFlush,channel.port1.onmessage=flush,flush()};var requestPortFlush=function(){channel.port2.postMessage(0)};requestFlush=function(){setTimeout(flush,0),requestPortFlush()}}else requestFlush=function(){setTimeout(flush,0)};module.exports=asap}),require.register("chrissrogers-promise/index.js",function(exports,require,module){"use strict";function ValuePromise(value){this.then=function(onFulfilled){return"function"!=typeof onFulfilled?this:new Promise(function(resolve,reject){asap(function(){try{resolve(onFulfilled(value))}catch(ex){reject(ex)}})})}}var Promise=require("./core.js"),asap=require("asap");module.exports=Promise,ValuePromise.prototype=Promise.prototype;var TRUE=new ValuePromise(!0),FALSE=new ValuePromise(!1),NULL=new ValuePromise(null),UNDEFINED=new ValuePromise(void 0),ZERO=new ValuePromise(0),EMPTYSTRING=new ValuePromise("");Promise.resolve=function(value){if(value instanceof Promise)return value;if(null===value)return NULL;if(void 0===value)return UNDEFINED;if(value===!0)return TRUE;if(value===!1)return FALSE;if(0===value)return ZERO;if(""===value)return EMPTYSTRING;if("object"==typeof value||"function"==typeof value)try{var then=value.then;if("function"==typeof then)return new Promise(then.bind(value))}catch(ex){return new Promise(function(resolve,reject){reject(ex)})}return new ValuePromise(value)},Promise.from=Promise.cast=function(value){var err=new Error("Promise.from and Promise.cast are deprecated, use Promise.resolve instead");return err.name="Warning",console.warn(err.stack),Promise.resolve(value)},Promise.denodeify=function(fn,argumentCount){return argumentCount=argumentCount||1/0,function(){var self=this,args=Array.prototype.slice.call(arguments);return new Promise(function(resolve,reject){for(;args.length&&args.length>argumentCount;)args.pop();args.push(function(err,res){err?reject(err):resolve(res)}),fn.apply(self,args)})}},Promise.nodeify=function(fn){return function(){var args=Array.prototype.slice.call(arguments),callback="function"==typeof args[args.length-1]?args.pop():null;try{return fn.apply(this,arguments).nodeify(callback)}catch(ex){if(null===callback||"undefined"==typeof callback)return new Promise(function(resolve,reject){reject(ex)});asap(function(){callback(ex)})}}},Promise.all=function(){var calledWithArray=1===arguments.length&&Array.isArray(arguments[0]),args=Array.prototype.slice.call(calledWithArray?arguments[0]:arguments);if(!calledWithArray){var err=new Error("Promise.all should be called with a single array, calling it with multiple arguments is deprecated");err.name="Warning",console.warn(err.stack)}return new Promise(function(resolve,reject){function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,function(val){res(i,val)},reject)}args[i]=val,0===--remaining&&resolve(args)}catch(ex){reject(ex)}}if(0===args.length)return resolve([]);for(var remaining=args.length,i=0;i<args.length;i++)res(i,args[i])})},Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})},Promise.race=function(values){return new Promise(function(resolve,reject){values.forEach(function(value){Promise.resolve(value).then(resolve,reject)})})},Promise.prototype.done=function(onFulfilled,onRejected){var self=arguments.length?this.then.apply(this,arguments):this;self.then(null,function(err){asap(function(){throw err})})},Promise.prototype.nodeify=function(callback){return"function"!=typeof callback?this:void this.then(function(value){asap(function(){callback(null,value)})},function(err){asap(function(){callback(err)})})},Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)}}),require.register("chrissrogers-promise/core.js",function(exports,require,module){"use strict";function Promise(fn){function handle(deferred){return null===state?void deferreds.push(deferred):void asap(function(){var cb=state?deferred.onFulfilled:deferred.onRejected;if(null===cb)return void(state?deferred.resolve:deferred.reject)(value);var ret;try{ret=cb(value)}catch(e){return void deferred.reject(e)}deferred.resolve(ret)})}function resolve(newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if("function"==typeof then)return void doResolve(then.bind(newValue),resolve,reject)}state=!0,value=newValue,finale()}catch(e){reject(e)}}function reject(newValue){state=!1,value=newValue,finale()}function finale(){for(var i=0,len=deferreds.length;len>i;i++)handle(deferreds[i]);deferreds=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");var state=null,value=null,deferreds=[],self=this;this.then=function(onFulfilled,onRejected){return new self.constructor(function(resolve,reject){handle(new Handler(onFulfilled,onRejected,resolve,reject))})},doResolve(fn,resolve,reject)}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.resolve=resolve,this.reject=reject}function doResolve(fn,onFulfilled,onRejected){var done=!1;try{fn(function(value){done||(done=!0,onFulfilled(value))},function(reason){done||(done=!0,onRejected(reason))})}catch(ex){if(done)return;done=!0,onRejected(ex)}}var asap=require("asap");module.exports=Promise}),require.register("kewah-mixin/index.js",function(exports,require,module){"function"==typeof Object.keys?module.exports=function(to,from){Object.keys(from).forEach(function(property){Object.defineProperty(to,property,Object.getOwnPropertyDescriptor(from,property))})}:module.exports=function(to,from){for(var property in from)from.hasOwnProperty(property)&&(to[property]=from[property])}}),require.register("pluma-par/dist/par.js",function(exports,require,module){function par(fn){var args0=slice.call(arguments,1);return function(){var argsN=slice.call(arguments,0),args=[];return args.push.apply(args,args0),args.push.apply(args,argsN),fn.apply(this,args)}}function rpartial(fn){var argsN=slice.call(arguments,1);return function(){var args=slice.call(arguments,0);return args.push.apply(args,argsN),fn.apply(this,args)}}var slice=Array.prototype.slice;par.rpartial=rpartial,par.lpartial=par,module.exports=par}),require.register("ianstormtaylor-to-no-case/index.js",function(exports,require,module){function toNoCase(string){return hasSpace.test(string)?string.toLowerCase():(hasSeparator.test(string)&&(string=unseparate(string)),hasCamel.test(string)&&(string=uncamelize(string)),string.toLowerCase())}function unseparate(string){return string.replace(separatorSplitter,function(m,next){return next?" "+next:""})}function uncamelize(string){return string.replace(camelSplitter,function(m,previous,uppers){return previous+" "+uppers.toLowerCase().split("").join(" ")})}module.exports=toNoCase;var hasSpace=/\s/,hasCamel=/[a-z][A-Z]/,hasSeparator=/[\W_]/,separatorSplitter=/[\W_]+(.|$)/g,camelSplitter=/(.)([A-Z]+)/g}),require.register("ianstormtaylor-to-space-case/index.js",function(exports,require,module){function toSpaceCase(string){return clean(string).replace(/[\W_]+(.|$)/g,function(matches,match){return match?" "+match:""})}var clean=require("to-no-case");module.exports=toSpaceCase}),require.register("ianstormtaylor-to-slug-case/index.js",function(exports,require,module){function toSlugCase(string){return toSpace(string).replace(/\s/g,"-")}var toSpace=require("to-space-case");module.exports=toSlugCase}),require.register("recurly/lib/index.js",function(exports,require,module){var Recurly=require("./recurly");module.exports=exports=new Recurly,exports.Recurly=Recurly}),require.register("recurly/lib/recurly.js",function(exports,require,module){function Recurly(options){this.id=0,this.version=version,this.configured=!1,this.config=merge({},defaults),options&&this.configure(options)}var json=(require("bind"),require("json")),each=require("each"),type=require("type"),merge=require("merge"),mixin=require("mixin"),jsonp=require("jsonp"),qs=require("querystring"),Emitter=require("emitter"),errors=require("./errors"),version=require("./version"),debug=require("debug")("recurly"),defaults={currency:"USD",timeout:6e4,publicKey:"",api:"https://api.recurly.com/js/v1"},mixins=["open","coupon","paypal","plan","tax","token","pricing","validate"];module.exports=Recurly,Emitter(Recurly.prototype),Recurly.prototype.configure=function(options){if(this.configured)throw errors("already-configured");if(debug("configure"),"string"===type(options)&&(options={publicKey:options}),!("publicKey"in options))throw errors("missing-public-key");this.config.publicKey=options.publicKey,"api"in options&&(this.config.api=options.api),"currency"in options&&(this.config.currency=options.currency),this.configured=!0},Recurly.prototype.url=function(route){return this.config.api+route},Recurly.prototype.request=function(route,data,done){if(debug("request"),!1===this.configured)throw errors("not-configured");"function"==type(data)&&(done=data,data={});var url=this.url(route),timeout=this.config.timeout;data.version=this.version,data.key=this.config.publicKey,url+="?"+qs.stringify(data),this.cache(url,function(res,set){return res?done(null,res):void jsonp(url,{timeout:timeout},function(err,res){return err?done(err):void(res.error?done(errors("api-error",res.error)):done(null,set(res)))})})},Recurly.prototype.cache=function(url,done){function set(obj){return obj}debug("cache");var stored=localStorage.getItem(url);return stored?(debug("cache found "+url),done(json.parse(stored))):(debug("cache set "+url),done(null,set))},each(mixins,function(name){mixin(Recurly.prototype,require("./recurly/"+name))})}),require.register("recurly/lib/version.js",function(exports,require,module){module.exports="3.0.5"}),require.register("recurly/lib/errors.js",function(exports,require,module){function errors(name,options){return errors.get(name,options)}var mixin=require("mixin");module.exports=exports=errors,errors.map={},errors.baseURL="",errors.doc=function(baseURL){errors.baseURL=baseURL},errors.get=function(name,context){if(name in errors.map)return new errors.map[name](context);throw new Error("invalid error")},errors.add=function(name,config){function RecurlyError(context){Error.call(this),this.name=this.code=name,this.message=config.message,mixin(this,context||{}),config.help&&(this.help=errors.baseURL+config.help,this.message+=" (need help? "+this.help+")")}return config=config||{},RecurlyError.prototype=new Error,errors.map[name]=RecurlyError},errors.doc("https://docs.recurly.com/js"),errors.add("already-configured",{message:"Configuration may only be set once.",help:"#identify-your-site"}),errors.add("not-configured",{message:"Not configured. You must first call recurly.configure().",help:"#identify-your-site"}),errors.add("missing-public-key",{message:"The publicKey setting is required.",help:"#identify-your-site"}),errors.add("api-error",{message:"There was an error with your request."}),errors.add("validation",{message:"There was an error validating your request."}),errors.add("missing-callback",{message:"Missing callback"}),errors.add("invalid-options",{message:"Options must be an object"}),errors.add("missing-plan",{message:"A plan must be specified."}),errors.add("missing-coupon",{message:"A coupon must be specified."}),errors.add("invalid-item",{message:"The given item does not appear to be a valid recurly plan, coupon, addon, or taxable address."}),errors.add("invalid-addon",{message:"The given addon_code is not among the valid addons for the specified plan."}),errors.add("invalid-currency",{message:"The given currency is not among the valid codes for the specified plan."}),errors.add("unremovable-item",{message:"The given item cannot be removed."})}),require.register("recurly/lib/util/dom.js",function(exports,require,module){function element(node){var isJQuery=window.jQuery&&node instanceof jQuery,isArray="array"===type(node);(isJQuery||isArray)&&(node=node[0]);var isElem="undefined"!=typeof HTMLElement?node instanceof HTMLElement:node&&1===node.nodeType;return isElem&&node}function value(node,value){return element(node)?"undefined"!=typeof value?valueSet(node,value):valueGet(node):null}function valueGet(node){node=element(node);var value,nodeType=node&&node.type&&node.type.toLowerCase();if(nodeType)if("options"in node)value=node.options[node.selectedIndex].value;else if("checkbox"===nodeType)node.checked&&(value=node.value);else if("radio"===nodeType){var radios=document.querySelectorAll('input[data-recurly="'+data(node,"recurly")+'"]');each(radios,function(radio){radio.checked&&(value=radio.value)})}else"value"in node&&(value=node.value);else value="";return value}function valueSet(nodes,value){"array"!==type(nodes)&&(nodes=[nodes]),each(nodes,function(node){node&&("value"in node?node.value=value:"textContent"in node?node.textContent=value:"innerText"in node&&(node.innerText=value));
})}function data(node,key,value){return(node=element(node))?"undefined"!=typeof value?dataSet(node,key,value):dataGet(node,key):void 0}function dataGet(node,key){return node.dataset?node.dataset[key]:node.getAttribute("data-"+slug(key))}function dataSet(node,key,value){node.dataset?node.dataset[key]=value:node.setAttribute("data-"+slug(key),value)}var slug=require("to-slug-case"),type=require("type"),each=require("each");require("map");module.exports={element:element,value:value,data:data}}),require.register("recurly/lib/util/parse-card.js",function(exports,require,module){module.exports=function(number){return number&&number.toString().replace(/[-\s]/g,"")}}),require.register("recurly/lib/recurly/open.js",function(exports,require,module){var bind=require("bind"),type=require("type"),json=require("json"),events=require("event"),qs=require("querystring"),errors=require("../errors"),debug=require("debug")("recurly:open");exports.open=function(url,data,done){if(debug("open"),!1===this.configured)throw errors("not-configured");"function"==type(data)&&(done=data,data={}),data=data||{},data.version=this.version,data.event="recurly-open-"+this.id++,data.key=this.config.publicKey,this.once(data.event,done),/^https?:\/\//.test(url)||(url=this.url(url)),url+=(~url.indexOf("?")?"&":"?")+qs.stringify(data),this.relay(function(){window.open(url)})},exports.relay=function(done){var self=this;if(!1===this.configured)throw errors("not-configured");if(events.bind(window,"message",function listener(event){var data=json.parse(event.data),name=data.recurly_event,body=data.recurly_message,err=body.error?errors("api-error",body.error):null;events.unbind(window,"message",listener),name&&self.emit(name,err,body),frame&&document.body.removeChild(frame)}),"documentMode"in document){var frame=document.createElement("iframe");frame.width=frame.height=0,frame.src=this.url("/relay"),frame.name="recurly-relay",frame.style.display="none",frame.onload=bind(this,done),document.body.appendChild(frame)}else done()}}),require.register("recurly/lib/recurly/coupon.js",function(exports,require,module){var type=require("type"),debug=require("debug")("recurly:coupon"),errors=require("../errors");exports.coupon=function(options,callback){if(debug("%j",options),"function"!==type(callback))throw errors("missing-callback");if("object"!==type(options))throw errors("invalid-options");if(!("plan"in options))throw errors("missing-plan");if(!("coupon"in options))throw errors("missing-coupon");this.request("/plans/"+options.plan+"/coupons/"+options.coupon,options,callback)}}),require.register("recurly/lib/recurly/paypal.js",function(exports,require,module){var debug=require("debug")("recurly:paypal");exports.paypal=function(data,done){debug("start"),this.open("/paypal/start",data,done)}}),require.register("recurly/lib/recurly/plan.js",function(exports,require,module){var type=require("type"),debug=require("debug")("recurly:plan");exports.plan=function(code,callback){if(debug("%s",code),"function"!=type(callback))throw new Error("Missing callback");return"undefined"==type(code)?callback(new Error("Missing plan code")):void this.request("/plans/"+code,callback)}}),require.register("recurly/lib/recurly/tax.js",function(exports,require,module){var type=require("type"),clone=require("clone");require("debug")("recurly:tax");exports.tax=function(options,callback){var request=clone(options);if("function"!=type(callback))throw new Error("Missing callback");"currency"in request||(request.currency=this.config.currency),this.request("/tax",request,callback)}}),require.register("recurly/lib/recurly/token.js",function(exports,require,module){function normalize(options){var el=dom.element(options),data={fields:{},values:{}};return el&&"form"===el.nodeName.toLowerCase()?each(el.querySelectorAll("[data-recurly]"),function(field){var name=dom.data(field,"recurly");~index(fields,name)&&(data.fields[name]=field,data.values[name]=dom.value(field))}):data.values=options,data.values.number=parseCard(data.values.number),data}function validate(input){var errors=[];return this.validate.cardNumber(input.number)||errors.push("number"),this.validate.expiry(input.month,input.year)||errors.push("month","year"),input.first_name||errors.push("first_name"),input.last_name||errors.push("last_name"),errors}var bind=require("bind"),each=require("each"),type=require("type"),index=require("indexof"),dom=(require("debug")("recurly:token"),require("../util/dom")),parseCard=require("../util/parse-card"),errors=require("../errors"),fields=["first_name","last_name","number","month","year","cvv","address1","address2","country","city","state","postal_code","phone","vat_number","token"];exports.token=function(options,done){var data=(bind(this,this.open),normalize(options)),input=data.values,userErrors=validate.call(this,input);if("function"!==type(done))throw errors("missing-callback");return userErrors.length?done(errors("validation",{fields:userErrors})):void this.request("/token",input,function(err,res){return err?done(err):(data.fields.token&&res.id&&(data.fields.token.value=res.id),void done(null,res))})}}),require.register("recurly/lib/recurly/validate.js",function(exports,require,module){var find=require("find"),trim=require("trim"),index=require("indexof"),parseCard=require("../util/parse-card"),types=[{type:"discover",pattern:/^(6011|622|64[4-9]|65)/,lengths:[16]},{type:"master",pattern:/^5[0-5]/,lengths:[16]},{type:"american_express",pattern:/^3[47]/,lengths:[15]},{type:"visa",pattern:/^4/,lengths:[13,16]},{type:"jcb",pattern:/^35[2-8]\d/,lengths:[16]},{type:"diners_club",pattern:/^(30[0-5]|309|36|3[89]|54|55|2014|2149)/,lengths:[14]}];exports.validate={cardNumber:function(number){for(var ca,str=parseCard(number),sum=0,mul=1,i=str.length;i--;)ca=parseInt(str.charAt(i),10)*mul,sum+=ca-9*(ca>9),mul^=3;return sum%10===0&&sum>0},cardType:function(number){var str=parseCard(number),card=find(types,function(card){return card.pattern.test(str)&&~index(card.lengths,str.length)});return card&&card.type||"unknown"},expiry:function(month,year){if(month=parseInt(month,10)-1,0>month||month>11)return!1;year=parseInt(year,10),year+=100>year?2e3:0;var expiry=new Date;return expiry.setYear(year),expiry.setDate(1),expiry.setHours(0),expiry.setMinutes(0),expiry.setSeconds(0),expiry.setMonth(month+1),new Date<expiry},cvv:function(number){return number=trim(number+""),/^\d+$/.test(number)&&(3===number.length||4===number.length)}}}),require.register("recurly/lib/recurly/pricing/index.js",function(exports,require,module){function Pricing(recurly){return this instanceof require("../../recurly")?new Pricing(this):(this.recurly=recurly,void this.reset())}function addonQuantity(meta,planAddon){var qty=1;return"quantity"in planAddon&&(qty=planAddon.quantity),"quantity"in meta&&(qty=meta.quantity),parseInt(qty,10)||0}function findAddon(addons,code){return addons&&find(addons,{code:code})}var Emitter=require("emitter"),index=require("indexof"),type=(require("each"),require("type")),find=(require("bind"),require("find")),mixin=require("mixin"),keys=require("object").keys,json=require("json"),debug=require("debug")("recurly:pricing"),PricingPromise=require("./promise"),Calculations=require("./calculations"),errors=require("../../errors");exports.Pricing=Pricing,Emitter(Pricing.prototype),Pricing.properties=["plan","addon","coupon","address","currency"],Pricing.prototype.reset=function(){this.items={},this.items.addons=[],this.currency(this.recurly.config.currency)},Pricing.prototype.remove=function(opts,done){var item,self=this;return debug("remove"),new PricingPromise(function(resolve,reject){var prop=keys(opts)[0],id=opts[prop];if(!~index(Pricing.properties,prop))return reject(errors("invalid-item"));if("addon"===prop){var pos=index(self.items.addons,findAddon(self.items.addons,{code:id}));~pos&&(item=self.items.addons.splice(pos))}else{if(!self.items[prop]||id!==self.items[prop].code&&id!==!0)return reject(errors("unremovable-item",{type:prop,id:id,reason:"does not exist on this pricing instance."}));item=self.items[prop],delete self.items[prop]}},this).nodeify(done)},Pricing.prototype.reprice=function(done){var self=this;return debug("reprice"),new PricingPromise(function(resolve,reject){return self.items.plan?void Calculations(self,function(price){return json.stringify(price)===json.stringify(self.price)?resolve(price):(self.price=price,self.emit("change",price),void resolve(price))}):reject(errors("missing-plan"))},this).nodeify(done)},Pricing.prototype.plan=function(planCode,meta,done){var quantity,self=this,plan=this.items.plan;return"function"===type(meta)&&(done=meta,meta=void 0),meta=meta||{},plan&&plan.quantity&&(quantity=plan.quantity),meta.quantity&&(quantity=parseInt(meta.quantity,10)),(!quantity||1>quantity)&&(quantity=1),new PricingPromise(function(resolve,reject){return plan&&plan.code===planCode?(plan.quantity=quantity,resolve(plan)):void self.recurly.plan(planCode,function(err,plan){return err?reject(err):(plan.quantity=quantity,self.items.plan=plan,self.items.currency in plan.price||self.currency(keys(plan.price)[0]),debug("set.plan"),self.emit("set.plan",plan),void resolve(plan))})},this).nodeify(done)},Pricing.prototype.addon=function(addonCode,meta,done){var self=this;return"function"===type(meta)&&(done=meta,meta=void 0),meta=meta||{},new PricingPromise(function(resolve,reject){if(!self.items.plan)return reject(errors("missing-plan"));var planAddon=findAddon(self.items.plan.addons,addonCode);if(!planAddon)return reject(errors("invalid-addon",{planCode:self.items.plan.code,addonCode:addonCode}));var quantity=addonQuantity(meta,planAddon),addon=findAddon(self.items.addons,addonCode);0===quantity&&self.remove({addon:addonCode}),addon?addon.quantity=quantity:(addon=json.parse(json.stringify(planAddon)),addon.quantity=quantity,self.items.addons.push(addon)),debug("set.addon"),self.emit("set.addon",addon),resolve(addon)},this).nodeify(done)},Pricing.prototype.coupon=function(couponCode,done){var self=this,coupon=this.items.coupon;return new PricingPromise(function(resolve,reject){if(!self.items.plan)return reject(errors("missing-plan"));if(coupon){if(coupon.code===couponCode)return resolve(coupon);self.remove({coupon:coupon.code})}return couponCode?void self.recurly.coupon({plan:self.items.plan.code,coupon:couponCode},function(err,coupon){return err&&"not_found"!==err.code?reject(err):(self.items.coupon=coupon,debug("set.coupon"),self.emit("set.coupon",coupon),void resolve(coupon))}):resolve()},this).nodeify(done)},Pricing.prototype.address=function(address,done){var self=this;return new PricingPromise(function(resolve,reject){return json.stringify(address)===json.stringify(self.items.address)?resolve(self.items.address):(self.items.address=address,debug("set.address"),self.emit("set.address",address),void resolve(address))},this).nodeify(done)},Pricing.prototype.currency=function(code,done){var self=this,plan=this.items.plan,currency=this.items.currency;return new PricingPromise(function(resolve,reject){return currency===code?resolve(currency):!plan||code in plan.price?(self.items.currency=code,debug("set.currency"),self.emit("set.currency",code),void resolve(code)):reject(errors("invalid-currency",{currencyCode:code,planCurrencies:keys(plan.price)}))},this).nodeify(done)},mixin(Pricing.prototype,require("./attach"))}),require.register("recurly/lib/recurly/pricing/promise.js",function(exports,require,module){function PricingPromise(resolver,pricing){if(!(this instanceof PricingPromise))return new PricingPromise(resolver,pricing);var self=this;this.pricing=pricing,this.constructor=par.rpartial(this.constructor,pricing),Promise.call(this,resolver),each(require("./").Pricing.prototype,function(method){self[method]=function(){var args=arguments;return self.then(function(){return self.pricing[method].apply(self.pricing,args)})}})}var Promise=require("promise"),mixin=require("mixin"),each=(require("bind"),require("each")),type=require("type"),par=require("par");require("debug")("recurly:pricing:promise");module.exports=PricingPromise,mixin(PricingPromise.prototype,Promise.prototype),PricingPromise.prototype.constructor=PricingPromise,PricingPromise.prototype.done=function(){return Promise.prototype.done.apply(this.then(this.reprice),arguments),this.pricing},PricingPromise.prototype.nodeify=function(done){return"function"===type(done)&&this.reprice(),Promise.prototype.nodeify.apply(this,arguments)}}),require.register("recurly/lib/recurly/pricing/calculations.js",function(exports,require,module){function Calculations(pricing,done){return this instanceof Calculations?(this.pricing=pricing,this.items=pricing.items,this.price={now:{},next:{},addons:{},currency:{code:this.items.currency,symbol:this.planPrice().symbol}},this.subtotal(),void this.tax(function(){this.total(),each(this.price.now,decimal,this.price.now),each(this.price.next,decimal,this.price.next),each(this.price.addons,decimal,this.price.addons),done(this.price)})):new Calculations(pricing,done)}function decimal(prop){this[prop]=(Math.round(100*Math.max(this[prop],0))/100).toFixed(2)}var each=require("each"),find=(require("bind"),require("find"));module.exports=Calculations,Calculations.prototype.subtotal=function(){var subtotal=this.planPrice().amount;this.price.now.subtotal=subtotal,this.price.next.subtotal=subtotal,this.items.plan.trial&&(this.price.now.subtotal=0),this.addons(),this.price.now.subtotal+=this.price.now.addons,this.price.next.subtotal+=this.price.next.addons,this.discount(),this.price.now.subtotal-=this.price.now.discount,this.price.next.subtotal-=this.price.next.discount,this.setupFee(),this.price.now.subtotal+=this.price.now.setup_fee},Calculations.prototype.tax=function(done){if(this.price.now.tax=0,this.price.next.tax=0,this.items.address){var self=this;this.pricing.recurly.tax(this.items.address,function(err,taxes){err?self.pricing.emit("error",err):(each(taxes,function(tax){"usst"===tax.type&&self.items.plan.tax_exempt||(self.price.now.tax+=self.price.now.subtotal*tax.rate,self.price.next.tax+=self.price.next.subtotal*tax.rate)}),self.price.now.tax=Math.ceil(100*self.price.now.tax)/100,self.price.next.tax=Math.ceil(100*self.price.next.tax)/100),done.call(self)})}else done.call(this)},Calculations.prototype.total=function(){this.price.now.total=this.price.now.subtotal+this.price.now.tax,this.price.next.total=this.price.next.subtotal+this.price.next.tax},Calculations.prototype.addons=function(){this.price.now.addons=0,this.price.next.addons=0,each(this.items.plan.addons,function(addon){var price=addon.price[this.items.currency].unit_amount;this.price.addons[addon.code]=price;var selected=find(this.items.addons,{code:addon.code});selected&&(price*=selected.quantity,this.items.plan.trial||(this.price.now.addons+=price),this.price.next.addons+=price)},this)},Calculations.prototype.discount=function(){var coupon=this.items.coupon;this.price.now.discount=0,this.price.next.discount=0,coupon&&(coupon.discount.rate?(this.price.now.discount=Math.round(this.price.now.subtotal*coupon.discount.rate*100)/100,this.price.next.discount=Math.round(this.price.next.subtotal*coupon.discount.rate*100)/100):(this.price.now.discount=coupon.discount.amount[this.items.currency],this.price.next.discount=coupon.discount.amount[this.items.currency]))},Calculations.prototype.setupFee=function(){this.price.now.setup_fee=this.planPrice().setup_fee,this.price.next.setup_fee=0},Calculations.prototype.planPrice=function(){var plan=this.items.plan,price=plan.price[this.items.currency];return price.amount=price.unit_amount*(plan.quantity||1),price}}),require.register("recurly/lib/recurly/pricing/attach.js",function(exports,require,module){function ignoreBadCoupons(err){if("not-found"!==err.code)throw err}var each=require("each"),events=require("event"),find=require("find"),dom=(require("type"),require("../../util/dom")),debug=require("debug")("recurly:pricing:attach");exports.attach=function(el){function change(event){function addons(){each(elems.addon,function(node){var plan=self.items.plan,addonCode=dom.data(node,"recurlyAddon");plan.addons&&find(plan.addons,{code:addonCode})&&(pricing=pricing.addon(addonCode,{quantity:dom.value(node)}))})}function target(name){return targetName?targetName===name?!0:!1:!0}debug("change");var targetName=event&&event.target&&dom.data(event.target,"recurly");targetName=targetName||window.event&&window.event.srcElement;var pricing=self.plan(dom.value(elems.plan),{quantity:dom.value(elems.plan_quantity)});target("currency")&&(pricing=pricing.currency(dom.value(elems.currency))),target("addon")&&elems.addon&&addons(),target("coupon")&&elems.coupon&&(pricing=pricing.coupon(dom.value(elems.coupon)).then(null,ignoreBadCoupons)),(target("country")||target("postal_code")||target("vat_number"))&&(pricing=pricing.address({country:dom.value(elems.country),postal_code:dom.value(elems.postal_code),vat_number:dom.value(elems.vat_number)})),pricing.done()}function update(price){dom.value(elems.currency_code,price.currency.code),dom.value(elems.currency_symbol,price.currency.symbol),each(["addons","discount","setup_fee","subtotal","tax","total"],function(value){dom.value(elems[value+"_now"],price.now[value]),dom.value(elems[value+"_next"],price.next[value])}),elems.addonPrice&&each(elems.addonPrice,function(elem){var addonPrice=price.addons[dom.data(elem,"recurlyAddon")];addonPrice&&dom.value(elem,addonPrice)})}function detatch(){each(elems,function(name,elems){each(elems,function(elem){events.unbind(elem,"change",change),events.unbind(elem,"propertychange",change)},this)},this)}var self=this,elems={},el=dom.element(el);if(!el)throw new Error("invalid dom element");this.attach.detatch&&this.attach.detatch(),self.on("change",update),each(el.querySelectorAll("[data-recurly]"),function(elem){"zip"===dom.data(elem,"recurly")&&dom.data(elem,"recurly","postal_code");var name=dom.data(elem,"recurly");elems[name]||(elems[name]=[]),elems[name].push(elem),events.bind(elem,"change",change),events.bind(elem,"propertychange",change)}),this.attach.detatch=detatch,change()},exports.binding=exports.attach}),require.alias("visionmedia-node-querystring/index.js","recurly/deps/querystring/index.js"),require.alias("visionmedia-node-querystring/index.js","querystring/index.js"),require.alias("component-emitter/index.js","recurly/deps/emitter/index.js"),require.alias("component-emitter/index.js","emitter/index.js"),require.alias("component-indexof/index.js","recurly/deps/indexof/index.js"),require.alias("component-indexof/index.js","indexof/index.js"),require.alias("component-object/index.js","recurly/deps/object/index.js"),require.alias("component-object/index.js","object/index.js"),require.alias("component-event/index.js","recurly/deps/event/index.js"),require.alias("component-event/index.js","event/index.js"),require.alias("component-clone/index.js","recurly/deps/clone/index.js"),require.alias("component-clone/index.js","clone/index.js"),require.alias("component-type/index.js","component-clone/deps/type/index.js"),require.alias("component-bind/index.js","recurly/deps/bind/index.js"),require.alias("component-bind/index.js","bind/index.js"),require.alias("component-each/index.js","recurly/deps/each/index.js"),require.alias("component-each/index.js","each/index.js"),require.alias("component-to-function/index.js","component-each/deps/to-function/index.js"),require.alias("component-props/index.js","component-to-function/deps/props/index.js"),require.alias("component-type/index.js","component-each/deps/type/index.js"),require.alias("component-find/index.js","recurly/deps/find/index.js"),require.alias("component-find/index.js","find/index.js"),require.alias("component-to-function/index.js","component-find/deps/to-function/index.js"),require.alias("component-props/index.js","component-to-function/deps/props/index.js"),require.alias("component-json/index.js","recurly/deps/json/index.js"),require.alias("component-json/index.js","json/index.js"),require.alias("component-type/index.js","recurly/deps/type/index.js"),require.alias("component-type/index.js","type/index.js"),require.alias("component-trim/index.js","recurly/deps/trim/index.js"),require.alias("component-trim/index.js","trim/index.js"),require.alias("component-map/index.js","recurly/deps/map/index.js"),require.alias("component-map/index.js","map/index.js"),require.alias("component-to-function/index.js","component-map/deps/to-function/index.js"),require.alias("component-props/index.js","component-to-function/deps/props/index.js"),require.alias("yields-merge/index.js","recurly/deps/merge/index.js"),require.alias("yields-merge/index.js","merge/index.js"),require.alias("learnboost-jsonp/index.js","recurly/deps/jsonp/index.js"),require.alias("learnboost-jsonp/index.js","recurly/deps/jsonp/index.js"),require.alias("learnboost-jsonp/index.js","jsonp/index.js"),require.alias("visionmedia-debug/debug.js","learnboost-jsonp/deps/debug/debug.js"),require.alias("visionmedia-debug/debug.js","learnboost-jsonp/deps/debug/index.js"),require.alias("visionmedia-debug/debug.js","visionmedia-debug/index.js"),require.alias("learnboost-jsonp/index.js","learnboost-jsonp/index.js"),require.alias("visionmedia-debug/debug.js","recurly/deps/debug/debug.js"),require.alias("visionmedia-debug/debug.js","recurly/deps/debug/index.js"),require.alias("visionmedia-debug/debug.js","debug/index.js"),require.alias("visionmedia-debug/debug.js","visionmedia-debug/index.js"),require.alias("chrissrogers-promise/index.js","recurly/deps/promise/index.js"),require.alias("chrissrogers-promise/core.js","recurly/deps/promise/core.js"),require.alias("chrissrogers-promise/index.js","promise/index.js"),require.alias("johntron-asap/asap.js","chrissrogers-promise/deps/asap/asap.js"),require.alias("johntron-asap/asap.js","chrissrogers-promise/deps/asap/index.js"),require.alias("johntron-asap/asap.js","johntron-asap/index.js"),require.alias("kewah-mixin/index.js","recurly/deps/mixin/index.js"),require.alias("kewah-mixin/index.js","recurly/deps/mixin/index.js"),require.alias("kewah-mixin/index.js","mixin/index.js"),require.alias("kewah-mixin/index.js","kewah-mixin/index.js"),require.alias("pluma-par/dist/par.js","recurly/deps/par/dist/par.js"),require.alias("pluma-par/dist/par.js","recurly/deps/par/index.js"),require.alias("pluma-par/dist/par.js","par/index.js"),require.alias("pluma-par/dist/par.js","pluma-par/index.js"),require.alias("ianstormtaylor-to-slug-case/index.js","recurly/deps/to-slug-case/index.js"),require.alias("ianstormtaylor-to-slug-case/index.js","to-slug-case/index.js"),require.alias("ianstormtaylor-to-space-case/index.js","ianstormtaylor-to-slug-case/deps/to-space-case/index.js"),require.alias("ianstormtaylor-to-no-case/index.js","ianstormtaylor-to-space-case/deps/to-no-case/index.js"),require.alias("recurly/lib/index.js","recurly/index.js"),"object"==typeof exports?module.exports=require("recurly"):"function"==typeof define&&define.amd?define("libs/recurly-3.0.5",[],function(){return require("recurly")}):this.recurly=require("recurly")}(),function(){define("main/plans",["base","libs/recurly-3.0.5"],function(App,recurly){return App.factory("MultiCurrencyPricing",function(){var currencyCode;return currencyCode=window.recomendedCurrency,{currencyCode:currencyCode,heron:{USD:{student:{monthly:"$6",annual:"$60"},collaborator:{monthly:"$12",annual:"$144"}},EUR:{student:{monthly:"€5",annual:"€50"},collaborator:{monthly:"€11",annual:"€132"}},GBP:{student:{monthly:"£5",annual:"£50"},collaborator:{monthly:"£10",annual:"£120"}},SEK:{student:{monthly:"45 kr",annual:"450 kr"},collaborator:{monthly:"90 kr",annual:"1080 kr"}},CAD:{student:{monthly:"$7",annual:"$70"},collaborator:{monthly:"$14",annual:"$168"}},NOK:{student:{monthly:"45 kr",annual:"450 kr"},collaborator:{monthly:"90 kr",annual:"1080 kr"}},DKK:{student:{monthly:"40 kr",annual:"400 kr"},collaborator:{monthly:"70 kr",annual:"840 kr"}},AUD:{student:{monthly:"$8",annual:"$80"},collaborator:{monthly:"$15",annual:"$180"}},NZD:{student:{monthly:"$8",annual:"$80"},collaborator:{monthly:"$15",annual:"$180"}},CHF:{student:{monthly:"Fr 6",annual:"Fr 60"},collaborator:{monthly:"Fr 12",annual:"Fr 144"}},SGD:{student:{monthly:"$8",annual:"$80"},collaborator:{monthly:"$16",annual:"$192"}}},ibis:{USD:{student:{monthly:"$10",annual:"$100"},collaborator:{monthly:"$18",annual:"$216"}},EUR:{student:{monthly:"€9",annual:"€90"},collaborator:{monthly:"€17",annual:"€204"}},GBP:{student:{monthly:"£7",annual:"£70"},collaborator:{monthly:"£14",annual:"£168"}},SEK:{student:{monthly:"75 kr",annual:"750 kr"},collaborator:{monthly:"140 kr",annual:"1680 kr"}},CAD:{student:{monthly:"$12",annual:"$120"},collaborator:{monthly:"$22",annual:"$264"}},NOK:{student:{monthly:"75 kr",annual:"750 kr"},collaborator:{monthly:"140 kr",annual:"1680 kr"}},DKK:{student:{monthly:"68 kr",annual:"680 kr"},collaborator:{monthly:"110 kr",annual:"1320 kr"}},AUD:{student:{monthly:"$13",annual:"$130"},collaborator:{monthly:"$22",annual:"$264"}},NZD:{student:{monthly:"$14",annual:"$140"},collaborator:{monthly:"$22",annual:"$264"}},CHF:{student:{monthly:"Fr 10",annual:"Fr 100"},collaborator:{monthly:"Fr 18",annual:"Fr 216"}},SGD:{student:{monthly:"$14",annual:"$140"},collaborator:{monthly:"$25",annual:"$300"}}},plans:{USD:{symbol:"$",student:{monthly:"$8",annual:"$80"},collaborator:{monthly:"$15",annual:"$180"},professional:{monthly:"$30",annual:"$360"}},EUR:{symbol:"€",student:{monthly:"€7",annual:"€70"},collaborator:{monthly:"€14",annual:"€168"},professional:{monthly:"€28",annual:"€336"}},GBP:{symbol:"£",student:{monthly:"£6",annual:"£60"},collaborator:{monthly:"£12",annual:"£144"},professional:{monthly:"£24",annual:"£288"}},SEK:{symbol:"kr",student:{monthly:"60 kr",annual:"600 kr"},collaborator:{monthly:"110 kr",annual:"1320 kr"},professional:{monthly:"220 kr",annual:"2640 kr"}},CAD:{symbol:"$",student:{monthly:"$9",annual:"$90"},collaborator:{monthly:"$17",annual:"$204"},professional:{monthly:"$34",annual:"$408"}},NOK:{symbol:"kr",student:{monthly:"60 kr",annual:"600 kr"},collaborator:{monthly:"110 kr",annual:"1320 kr"},professional:{monthly:"220 kr",annual:"2640 kr"}},DKK:{symbol:"kr",student:{monthly:"50 kr",annual:"500 kr"},collaborator:{monthly:"90 kr",annual:"1080 kr"},professional:{monthly:"180 kr",annual:"2160 kr"}},AUD:{symbol:"$",student:{monthly:"$10",annual:"$100"},collaborator:{monthly:"$18",annual:"$216"},professional:{monthly:"$35",annual:"$420"}},NZD:{symbol:"$",student:{monthly:"$10",annual:"$100"},collaborator:{monthly:"$18",annual:"$216"},professional:{monthly:"$35",annual:"$420"}},CHF:{symbol:"Fr",student:{monthly:"Fr 8",annual:"Fr 80"},collaborator:{monthly:"Fr 15",annual:"Fr 180"},professional:{monthly:"Fr 30",annual:"Fr 360"}},SGD:{symbol:"$",student:{monthly:"$12",annual:"$120"},collaborator:{monthly:"$20",annual:"$240"},professional:{monthly:"$40",annual:"$480"}}}}}),App.controller("PlansController",function($scope,$modal,event_tracking,abTestManager,MultiCurrencyPricing,$http,sixpack){return $scope.showPlans=!1,$scope.plansVariant="default",$scope.shouldABTestPlans=window.shouldABTestPlans,$scope.shouldABTestPlans?sixpack.participate("plans-1610",["default","heron","ibis"],function(chosenVariation,rawResponse){var currency,_ref,_v;if($scope.plansVariant=chosenVariation,event_tracking.sendMB("plans-page",{plans_variant:chosenVariation}),"heron"===chosenVariation||"ibis"===chosenVariation){_ref=$scope.plans;for(currency in _ref)_v=_ref[currency],$scope.plans[currency].student=MultiCurrencyPricing[chosenVariation][currency].student,$scope.plans[currency].collaborator=MultiCurrencyPricing[chosenVariation][currency].collaborator}return $scope.showPlans=!0}):$scope.showPlans=!0,$scope.plans=MultiCurrencyPricing.plans,$scope.currencyCode=MultiCurrencyPricing.currencyCode,$scope.trial_len=7,$scope.planQueryString="_free_trial_7_days",$scope.ui={view:"monthly"},$scope.changeCurreny=function(newCurrency){return $scope.currencyCode=newCurrency},$scope.getCollaboratorPlanCode=function(){var variant,view;return view=$scope.ui.view,variant=$scope.plansVariant,"annual"===view?"default"===variant?"collaborator-annual":"collaborator-annual_"+variant:"default"===variant?"collaborator"+$scope.planQueryString:"collaborator_"+variant},$scope.signUpNowClicked=function(plan,annual){return event_tracking.sendMB("plans-page-start-trial",{plan:plan}),"annual"===$scope.ui.view&&(plan=""+plan+"_annual"),event_tracking.send("subscription-funnel","sign_up_now_button",plan)},$scope.switchToMonthly=function(){return $scope.ui.view="monthly",event_tracking.send("subscription-funnel","plans-page","monthly-prices")},$scope.switchToStudent=function(){return $scope.ui.view="student",event_tracking.send("subscription-funnel","plans-page","student-prices")},$scope.switchToAnnual=function(){return $scope.ui.view="annual",event_tracking.send("subscription-funnel","plans-page","student-prices")},$scope.openGroupPlanModal=function(){return $modal.open({templateUrl:"groupPlanModalTemplate"})}})})}.call(this),function(){define("main/group-members",["base"],function(App){return App.controller("SubscriptionGroupMembersController",function($scope,queuedHttp){var parseEmails;return $scope.users=window.users,$scope.groupSize=window.groupSize,$scope.selectedUsers=[],$scope.inputs={emails:""},parseEmails=function(emailsString){var emails,regexBySpaceOrComma;return regexBySpaceOrComma=/[\s,]+/,emails=emailsString.split(regexBySpaceOrComma),emails=_.map(emails,function(email){return email=email.trim()}),emails=_.select(emails,function(email){return-1!==email.indexOf("@")})},$scope.addMembers=function(){var email,emails,_i,_len,_results;for(emails=parseEmails($scope.inputs.emails),_results=[],_i=0,_len=emails.length;_len>_i;_i++)email=emails[_i],_results.push(queuedHttp.post("/subscription/group/user",{email:email,_csrf:window.csrfToken}).success(function(data){return null!=data.user&&$scope.users.push(data.user),$scope.inputs.emails=""}));return _results},$scope.removeMembers=function(){var user,_fn,_i,_len,_ref;for(_ref=$scope.selectedUsers,_fn=function(user){return queuedHttp({method:"DELETE",url:"/subscription/group/user/"+user._id,headers:{"X-Csrf-Token":window.csrfToken}}).success(function(){var index;return index=$scope.users.indexOf(user),-1!==index?$scope.users.splice(index,1):void 0})},_i=0,_len=_ref.length;_len>_i;_i++)user=_ref[_i],_fn(user);return $scope.selectedUsers=[]},$scope.updateSelectedUsers=function(){return $scope.selectedUsers=$scope.users.filter(function(user){return user.selected})}}),App.controller("SubscriptionGroupMemberListItemController",function($scope){return $scope.$watch("user.selected",function(value){return null!=value?$scope.updateSelectedUsers():void 0})})})}.call(this),function(){define("main/scribtex-popup",["base"],function(App){return App.controller("ScribtexPopupController",function($scope,$modal){return $modal.open({templateUrl:"scribtexModalTemplate"})})})}.call(this),function(){define("main/event",["base","modules/localStorage"],function(App){var CACHE_KEY,send;return CACHE_KEY="mbEvents",send=function(category,action,attributes){var event_name;return null==attributes&&(attributes={}),ga("send","event",category,action),event_name=""+action+"-"+category,"function"==typeof Intercom?Intercom("trackEvent",event_name,attributes):void 0},App.factory("event_tracking",function($http,localStorage){var _addEventToCache,_eventInCache,_getEventCache;return _getEventCache=function(){var eventCache;return eventCache=localStorage(CACHE_KEY),null==eventCache&&(eventCache={},localStorage(CACHE_KEY,eventCache)),eventCache},_eventInCache=function(key){var curCache;return curCache=_getEventCache(),curCache[key]||!1},_addEventToCache=function(key){var curCache;return curCache=_getEventCache(),curCache[key]=!0,localStorage(CACHE_KEY,curCache)},{send:function(category,action,label,value){return ga("send","event",category,action,label,value)},sendMB:function(key,segmentation){return null==segmentation&&(segmentation={}),$http({url:"/event/"+key,
method:"POST",data:segmentation,headers:{"X-CSRF-Token":window.csrfToken}})},sendMBSampled:function(key,segmentation){return Math.random()<.01?this.sendMB(key,segmentation):void 0},sendMBOnce:function(key,segmentation){return _eventInCache(key)?void 0:(_addEventToCache(key),this.sendMB(key,segmentation))}}}),$(".navbar a").on("click",function(e){var href;return href=$(e.target).attr("href"),null!=href?ga("send","event","navigation","top menu bar",href):void 0})})}.call(this),function(){define("main/bonus",["base"],function(App){return App.controller("BonusLinksController",function($scope,$modal){return $scope.openLinkToUsModal=function(){return $modal.open({templateUrl:"BonusLinkToUsModal",controller:"BonusModalController"})}}),App.controller("BonusModalController",function($scope,$modalInstance){return $scope.cancel=function(){return $modalInstance.dismiss()}})})}.call(this),function(){define("main/system-messages",["base"],function(App){return App.controller("SystemMessagesController",function($scope){return $scope.messages=window.systemMessages}),App.controller("SystemMessageController",function($scope,$sce){return $scope.hidden=$.localStorage("systemMessage.hide."+$scope.message._id),$scope.htmlContent=$sce.trustAsHtml($scope.message.content),$scope.hide=function(){return $scope.hidden=!0,$.localStorage("systemMessage.hide."+$scope.message._id,!0)}})})}.call(this),function(){define("main/translations",["base"],function(App){return App.controller("TranslationsPopupController",function($scope,ipCookie){return $scope.hidei18nNotification=ipCookie("hidei18nNotification"),$scope.dismiss=function(){return ipCookie("hidei18nNotification",!0,{expires:180}),$scope.hidei18nNotification=ipCookie("hidei18nNotification")}})})}.call(this),function(){define("main/subscription-dashboard",["base"],function(App){var PRICES,SUBSCRIPTION_URL,setupReturly;return App.controller("SuccessfulSubscriptionController",function($scope,sixpack){return sixpack.convert("plans-1610",function(){})}),SUBSCRIPTION_URL="/user/subscription/update",setupReturly=_.once(function(){return"undefined"!=typeof recurly&&null!==recurly?recurly.configure(window.recurlyApiKey):void 0}),PRICES={},App.controller("CurrenyDropdownController",function($scope,MultiCurrencyPricing,$q){return $scope.currencyCode=MultiCurrencyPricing.currencyCode,$scope.changeCurrency=function(newCurrency){return MultiCurrencyPricing.currencyCode=newCurrency}}),App.controller("ChangePlanFormController",function($scope,$modal,MultiCurrencyPricing){var taxRate;return setupReturly(),taxRate=window.taxRate,$scope.changePlan=function(){return $modal.open({templateUrl:"confirmChangePlanModalTemplate",controller:"ConfirmChangePlanController",scope:$scope})},$scope.$watch("pricing.currencyCode",function(){return $scope.currencyCode=MultiCurrencyPricing.currencyCode}),$scope.pricing=MultiCurrencyPricing,$scope.currencySymbol=MultiCurrencyPricing.plans[MultiCurrencyPricing.currencyCode].symbol,$scope.currencyCode=MultiCurrencyPricing.currencyCode,$scope.prices=PRICES,$scope.refreshPrice=function(planCode){var price,pricing;if(null==$scope.prices[planCode])return $scope.prices[planCode]="...",pricing=recurly.Pricing(),pricing.plan(planCode,{quantity:1}).currency(MultiCurrencyPricing.currencyCode).done(function(price){var totalPriceExTax;return totalPriceExTax=parseFloat(price.next.total),$scope.$evalAsync(function(){var taxAmmount;return taxAmmount=totalPriceExTax*taxRate,isNaN(taxAmmount)&&(taxAmmount=0),$scope.prices[planCode]=$scope.currencySymbol+(totalPriceExTax+taxAmmount)})}),price=""}}),App.controller("ConfirmChangePlanController",function($scope,$modalInstance,$http){return $scope.confirmChangePlan=function(){var body;return body={plan_code:$scope.plan.planCode,_csrf:window.csrfToken},$scope.inflight=!0,$http.post(""+SUBSCRIPTION_URL+"?origin=confirmChangePlan",body).success(function(){return location.reload()}).error(function(){return console.log("something went wrong changing plan")})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("LeaveGroupModalController",function($scope,$modalInstance,$http){return $scope.confirmLeaveGroup=function(){return $scope.inflight=!0,$http({url:"/subscription/group/user",method:"DELETE",params:{admin_user_id:$scope.admin_id,_csrf:window.csrfToken}}).success(function(){return location.reload()}).error(function(){return console.log("something went wrong changing plan")})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("UserSubscriptionController",function($scope,MultiCurrencyPricing,$http,sixpack,$modal){var freeTrialEndDate,freeTrialExpiresUnderSevenDays,freeTrialInFuture,isMonthlyCollab,sevenDaysTime,stillInFreeTrial,_ref,_ref1,_ref2,_ref3;return $scope.plans=MultiCurrencyPricing.plans,freeTrialEndDate=new Date("undefined"!=typeof subscription&&null!==subscription?subscription.trial_ends_at:void 0),sevenDaysTime=new Date,sevenDaysTime.setDate(sevenDaysTime.getDate()+7),freeTrialInFuture=freeTrialEndDate>new Date,freeTrialExpiresUnderSevenDays=sevenDaysTime>freeTrialEndDate,$scope.view="overview",$scope.getSuffix=function(planCode){var _ref;return(null!=planCode&&null!=(_ref=planCode.match(/(.*?)_(.*)/))?_ref[2]:void 0)||null},$scope.subscriptionSuffix=$scope.getSuffix("undefined"!=typeof window&&null!==window&&null!=(_ref=window.subscription)?_ref.planCode:void 0),"free_trial_7_days"===$scope.subscriptionSuffix&&($scope.subscriptionSuffix=""),$scope.isNextGenPlan="heron"===(_ref1=$scope.subscriptionSuffix)||"ibis"===_ref1,$scope.shouldShowPlan=function(planCode){var _ref2;return"heron"!==(_ref2=$scope.getSuffix(planCode))&&"ibis"!==_ref2},isMonthlyCollab=-1!==("undefined"!=typeof subscription&&null!==subscription&&null!=(_ref2=subscription.planCode)?_ref2.indexOf("collaborator"):void 0)&&-1===("undefined"!=typeof subscription&&null!==subscription&&null!=(_ref3=subscription.planCode)?_ref3.indexOf("ann"):void 0),stillInFreeTrial=freeTrialInFuture&&freeTrialExpiresUnderSevenDays,isMonthlyCollab&&stillInFreeTrial?$scope.showExtendFreeTrial=!0:isMonthlyCollab&&!stillInFreeTrial?$scope.showDowngradeToStudent=!0:$scope.showBasicCancel=!0,setupReturly(),recurly.Pricing().plan("student",{quantity:1}).currency(MultiCurrencyPricing.currencyCode).done(function(price){var totalPriceExTax;return totalPriceExTax=parseFloat(price.next.total),$scope.$evalAsync(function(){var taxAmmount;return taxAmmount=totalPriceExTax*taxRate,isNaN(taxAmmount)&&(taxAmmount=0),$scope.currencySymbol=MultiCurrencyPricing.plans[MultiCurrencyPricing.currencyCode].symbol,$scope.studentPrice=$scope.currencySymbol+(totalPriceExTax+taxAmmount)})}),$scope.downgradeToStudent=function(){var body;return body={plan_code:"student",_csrf:window.csrfToken},$scope.inflight=!0,$http.post(""+SUBSCRIPTION_URL+"?origin=downgradeToStudent",body).success(function(){return location.reload()}).error(function(){return console.log("something went wrong changing plan")})},$scope.cancelSubscription=function(){var body;return body={_csrf:window.csrfToken},$scope.inflight=!0,$http.post("/user/subscription/cancel",body).success(function(){return location.reload()}).error(function(){return console.log("something went wrong changing plan")})},$scope.removeSelfFromGroup=function(admin_id){return $scope.admin_id=admin_id,$modal.open({templateUrl:"LeaveGroupModalTemplate",controller:"LeaveGroupModalController",scope:$scope})},$scope.switchToCancelationView=function(){return $scope.view="cancelation"},$scope.exendTrial=function(){var body;return body={_csrf:window.csrfToken},$scope.inflight=!0,$http.put("/user/subscription/extend",body).success(function(){return location.reload()}).error(function(){return console.log("something went wrong changing plan")})}})})}.call(this),function(){define("directives/creditCards",["base"],function(App){return App.factory("ccUtils",function(){var cardFromNumber,cardFromType,cardType,cards,defaultFormat,defaultInputFormat,formatCardNumber,formatExpiry,parseExpiry;return defaultFormat=/(\d{1,4})/g,defaultInputFormat=/(?:^|\s)(\d{4})$/,cards=[{type:"visa",patterns:[4],format:defaultFormat,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",patterns:[51,52,53,54,55,22,23,24,25,26,27],format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"amex",patterns:[34,37],format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",patterns:[30,36,38,39],format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",patterns:[60,64,65,622],format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",patterns:[62,88],format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",patterns:[35],format:defaultFormat,length:[16],cvcLength:[3],luhn:!0}],cardFromNumber=function(num){var card,p,pattern,_i,_j,_len,_len1,_ref;for(num=(num+"").replace(/\D/g,""),_i=0,_len=cards.length;_len>_i;_i++)for(card=cards[_i],_ref=card.patterns,_j=0,_len1=_ref.length;_len1>_j;_j++)if(pattern=_ref[_j],p=pattern+"",num.substr(0,p.length)===p)return card},cardFromType=function(type){var card,_i,_len;for(_i=0,_len=cards.length;_len>_i;_i++)if(card=cards[_i],card.type===type)return card},cardType=function(num){var _ref;return num?(null!=(_ref=cardFromNumber(num))?_ref.type:void 0)||null:null},formatCardNumber=function(num){var card,groups,upperLength,_ref;return num=num.replace(/\D/g,""),(card=cardFromNumber(num))?(upperLength=card.length[card.length.length-1],num=num.slice(0,upperLength),card.format.global?null!=(_ref=num.match(card.format))?_ref.join(" "):void 0:(groups=card.format.exec(num),null!=groups?(groups.shift(),groups=$.grep(groups,function(n){return n}),groups.join(" ")):void 0)):num},formatExpiry=function(expiry){var mon,parts,sep,year;return(parts=expiry.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(mon=parts[1]||"",sep=parts[2]||"",year=parts[3]||"",year.length>0?sep=" / ":" /"===sep?(mon=mon.substring(0,1),sep=""):2===mon.length||sep.length>0?sep=" / ":1===mon.length&&"0"!==mon&&"1"!==mon&&(mon="0"+mon,sep=" / "),mon+sep+year):""},parseExpiry=function(value){var month,prefix,year,_ref;return null==value&&(value=""),_ref=value.split(/[\s\/]+/,2),month=_ref[0],year=_ref[1],2===(null!=year?year.length:void 0)&&/^\d+$/.test(year)&&(prefix=(new Date).getFullYear(),prefix=prefix.toString().slice(0,2),year=prefix+year),month=parseInt(month,10),year=parseInt(year,10),isNaN(month)||isNaN(year)?void 0:{month:month,year:year}},{fromNumber:cardFromNumber,fromType:cardFromType,cardType:cardType,formatExpiry:formatExpiry,formatCardNumber:formatCardNumber,defaultFormat:defaultFormat,defaultInputFormat:defaultInputFormat,parseExpiry:parseExpiry}}),App.factory("ccFormat",function(ccUtils,$filter){var formatBackCardNumber,formatBackExpiry,formatCardNumber,formatExpiry,formatForwardExpiry,formatForwardSlash,getFormattedCardNumber,hasTextSelected,parseCardNumber,parseExpiry,reFormatCVC,reFormatCardNumber,reFormatExpiry,reFormatNumeric,replaceFullWidthChars,restrictCVC,restrictCardNumber,restrictExpiry,restrictNumeric,safeVal,setCardType;return hasTextSelected=function($target){var _ref;return null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==$target.prop("selectionEnd")?!0:null!=("undefined"!=typeof document&&null!==document&&null!=(_ref=document.selection)?_ref.createRange:void 0)&&document.selection.createRange().text?!0:!1},safeVal=function(value,$target){var currPair,cursor,digit,error,last,prevPair;try{cursor=$target.prop("selectionStart")}catch(_error){error=_error,cursor=null}return last=$target.val(),$target.val(value),null!==cursor&&$target.is(":focus")?(cursor===last.length&&(cursor=value.length),last!==value&&(prevPair=last.slice(cursor-1,+cursor+1||9e9),currPair=value.slice(cursor-1,+cursor+1||9e9),digit=value[cursor],/\d/.test(digit)&&prevPair===""+digit+" "&&currPair===" "+digit&&(cursor+=1)),$target.prop("selectionStart",cursor),$target.prop("selectionEnd",cursor)):void 0},replaceFullWidthChars=function(str){var chars,chr,fullWidth,halfWidth,idx,value,_i,_len;for(null==str&&(str=""),fullWidth="０１２３４５６７８９",halfWidth="0123456789",value="",chars=str.split(""),_i=0,_len=chars.length;_len>_i;_i++)chr=chars[_i],idx=fullWidth.indexOf(chr),idx>-1&&(chr=halfWidth[idx]),value+=chr;return value},reFormatNumeric=function(e){var $target;return $target=$(e.currentTarget),setTimeout(function(){var value;return value=$target.val(),value=replaceFullWidthChars(value),value=value.replace(/\D/g,""),safeVal(value,$target)})},reFormatCardNumber=function(e){var $target;return $target=$(e.currentTarget),setTimeout(function(){var value;return value=$target.val(),value=replaceFullWidthChars(value),value=ccUtils.formatCardNumber(value),safeVal(value,$target)})},formatCardNumber=function(e){var $target,card,digit,length,re,upperLength,value;return digit=String.fromCharCode(e.which),!/^\d+$/.test(digit)||($target=$(e.currentTarget),value=$target.val(),card=ccUtils.fromNumber(value+digit),length=(value.replace(/\D/g,"")+digit).length,upperLength=16,card&&(upperLength=card.length[card.length.length-1]),length>=upperLength||null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==value.length)?void 0:(re=card&&"amex"===card.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,re.test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value+" "+digit)})):re.test(value+digit)?(e.preventDefault(),setTimeout(function(){return $target.val(value+digit+" ")})):void 0)},formatBackCardNumber=function(e){var $target,value;return $target=$(e.currentTarget),value=$target.val(),8!==e.which||null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==value.length?void 0:/\d\s$/.test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value.replace(/\d\s$/,""))})):/\s\d?$/.test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value.replace(/\d$/,""))})):void 0},getFormattedCardNumber=function(num){var card,groups,upperLength,_ref;return num=num.replace(/\D/g,""),(card=ccUtils.fromNumber(num))?(upperLength=card.length[card.length.length-1],num=num.slice(0,upperLength),card.format.global?null!=(_ref=num.match(card.format))?_ref.join(" "):void 0:(groups=card.format.exec(num),null!=groups?(groups.shift(),groups=$.grep(groups,function(n){return n}),groups.join(" ")):void 0)):num},parseCardNumber=function(value){return null!=value?value.replace(/\s/g,""):value},reFormatExpiry=function(e){var $target;return $target=$(e.currentTarget),setTimeout(function(){var value;return value=$target.val(),value=replaceFullWidthChars(value),value=ccUtils.formatExpiry(value),safeVal(value,$target)})},formatExpiry=function(e){var $target,digit,val;return digit=String.fromCharCode(e.which),/^\d+$/.test(digit)?($target=$(e.currentTarget),val=$target.val()+digit,/^\d$/.test(val)&&"0"!==val&&"1"!==val?(e.preventDefault(),setTimeout(function(){return $target.val("0"+val+" / ")})):/^\d\d$/.test(val)?(e.preventDefault(),setTimeout(function(){var m1,m2;return m1=parseInt(val[0],10),m2=parseInt(val[1],10),m2>2&&0!==m1?$target.val("0"+m1+" / "+m2):$target.val(""+val+" / ")})):void 0):void 0},formatForwardExpiry=function(e){var $target,digit,val;return digit=String.fromCharCode(e.which),/^\d+$/.test(digit)?($target=$(e.currentTarget),val=$target.val(),/^\d\d$/.test(val)?$target.val(""+val+" / "):void 0):void 0},formatForwardSlash=function(e){var $target,val,which;return which=String.fromCharCode(e.which),"/"===which||" "===which?($target=$(e.currentTarget),val=$target.val(),/^\d$/.test(val)&&"0"!==val?$target.val("0"+val+" / "):void 0):void 0},formatBackExpiry=function(e){var $target,value;return $target=$(e.currentTarget),value=$target.val(),8!==e.which||null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==value.length?void 0:/\d\s\/\s$/.test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value.replace(/\d\s\/\s$/,""))})):void 0},parseExpiry=function(value){var dateAsObj,expiry;if(null!=value){if(dateAsObj=ccUtils.parseExpiry(value),null==dateAsObj)return;return expiry=new Date(dateAsObj.year,dateAsObj.month-1),$filter("date")(expiry,"MM/yyyy")}},reFormatCVC=function(e){var $target;return $target=$(e.currentTarget),setTimeout(function(){var value;return value=$target.val(),value=replaceFullWidthChars(value),value=value.replace(/\D/g,"").slice(0,4),safeVal(value,$target)})},restrictNumeric=function(e){var input;return e.metaKey||e.ctrlKey?!0:32===e.which?!1:0===e.which?!0:e.which<33?!0:(input=String.fromCharCode(e.which),!!/[\d\s]/.test(input))},restrictCardNumber=function(e){var $target,card,digit,value;return $target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target)?(value=($target.val()+digit).replace(/\D/g,""),card=ccUtils.fromNumber(value),card?value.length<=card.length[card.length.length-1]:value.length<=16):void 0},restrictExpiry=function(e){var $target,digit,value;return $target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target)?(value=$target.val()+digit,value=value.replace(/\D/g,""),value.length>6?!1:void 0):void 0},restrictCVC=function(e){var $target,digit,val;return $target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target)?(val=$target.val()+digit,val.length<=4):void 0},setCardType=function(e){var $target,allTypes,card,cardType,val;return $target=$(e.currentTarget),val=$target.val(),cardType=ccUtils.cardType(val)||"unknown",$target.hasClass(cardType)?void 0:(allTypes=function(){var _i,_len,_results;for(_results=[],_i=0,_len=cards.length;_len>_i;_i++)card=cards[_i],_results.push(card.type);return _results}(),$target.removeClass("unknown"),$target.removeClass(allTypes.join(" ")),$target.addClass(cardType),$target.toggleClass("identified","unknown"!==cardType),$target.trigger("payment.cardType",cardType))},{hasTextSelected:hasTextSelected,replaceFullWidthChars:replaceFullWidthChars,reFormatNumeric:reFormatNumeric,reFormatCardNumber:reFormatCardNumber,formatCardNumber:formatCardNumber,formatBackCardNumber:formatBackCardNumber,getFormattedCardNumber:getFormattedCardNumber,parseCardNumber:parseCardNumber,reFormatExpiry:reFormatExpiry,formatExpiry:formatExpiry,formatForwardExpiry:formatForwardExpiry,formatForwardSlash:formatForwardSlash,formatBackExpiry:formatBackExpiry,parseExpiry:parseExpiry,reFormatCVC:reFormatCVC,restrictNumeric:restrictNumeric,restrictCardNumber:restrictCardNumber,restrictExpiry:restrictExpiry,restrictCVC:restrictCVC,setCardType:setCardType}}),App.directive("ccFormatExpiry",function(ccFormat){return{restrict:"A",require:"ngModel",link:function(scope,el,attrs,ngModel){return el.on("keypress",ccFormat.restrictNumeric),el.on("keypress",ccFormat.restrictExpiry),el.on("keypress",ccFormat.formatExpiry),el.on("keypress",ccFormat.formatForwardSlash),el.on("keypress",ccFormat.formatForwardExpiry),el.on("keydown",ccFormat.formatBackExpiry),el.on("change",ccFormat.reFormatExpiry),el.on("input",ccFormat.reFormatExpiry),el.on("paste",ccFormat.reFormatExpiry),ngModel.$parsers.push(ccFormat.parseExpiry),ngModel.$formatters.push(ccFormat.parseExpiry)}}}),App.directive("ccFormatCardNumber",function(ccFormat){return{restrict:"A",require:"ngModel",link:function(scope,el,attrs,ngModel){return el.on("keypress",ccFormat.restrictNumeric),el.on("keypress",ccFormat.restrictCardNumber),el.on("keypress",ccFormat.formatCardNumber),el.on("keydown",ccFormat.formatBackCardNumber),el.on("paste",ccFormat.reFormatCardNumber),ngModel.$parsers.push(ccFormat.parseCardNumber),ngModel.$formatters.push(ccFormat.getFormattedCardNumber)}}}),App.directive("ccFormatSecCode",function(ccFormat){return{restrict:"A",require:"ngModel",link:function(scope,el,attrs,ngModel){return el.on("keypress",ccFormat.restrictNumeric),el.on("keypress",ccFormat.restrictCVC),el.on("paste",ccFormat.reFormatCVC),el.on("change",ccFormat.reFormatCVC),el.on("input",ccFormat.reFormatCVC)}}})})}.call(this),function(){define("main/new-subscription",["base","directives/creditCards"],function(App){return App.controller("NewSubscriptionController",function($scope,MultiCurrencyPricing,abTestManager,$http,sixpack,event_tracking,ccUtils){var completeSubscription,initialPricing,inputHasError,isFormValid,pricing,setPaymentMethod,validateCardNumber,validateCvv,validateExpiry;if("undefined"==typeof recurly)throw new Error("Recurly API Library Missing.");return $scope.currencyCode=MultiCurrencyPricing.currencyCode,$scope.plans=MultiCurrencyPricing.plans,$scope.switchToStudent=function(){var currentPlanCode,planCode;return currentPlanCode=window.plan_code,planCode=currentPlanCode.replace("collaborator","student"),event_tracking.sendMB("subscription-form-switch-to-student",{plan:window.plan_code}),window.location="/user/subscription/new?planCode="+planCode+"&currency="+$scope.currencyCode+"&cc="+$scope.data.coupon},event_tracking.sendMB("subscription-form",{plan:window.plan_code}),$scope.paymentMethod={value:"credit_card"},$scope.data={number:"",month:"",year:"",cvv:"",first_name:"",last_name:"",postal_code:"",address1:"",address2:"",state:"",city:"",country:window.countryCode,coupon:window.couponCode,mmYY:""},$scope.validation={correctCardNumber:!0,correctExpiry:!0,correctCvv:!0},$scope.processing=!1,recurly.configure(window.recurlyApiKey),pricing=recurly.Pricing(),window.pricing=pricing,initialPricing=pricing.plan(window.plan_code,{quantity:1}).address({country:$scope.data.country}).tax({tax_code:"digital",vat_number:""}).currency($scope.currencyCode).coupon($scope.data.coupon).done(),pricing.on("change",function(_this){return function(){var basePrice,_ref,_ref1,_ref10,_ref11,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;return $scope.planName=pricing.items.plan.name,$scope.price=pricing.price,$scope.trialLength=null!=(_ref=pricing.items.plan.trial)?_ref.length:void 0,$scope.monthlyBilling=1===pricing.items.plan.period.length,"percent"===(null!=(_ref1=pricing.items)&&null!=(_ref2=_ref1.coupon)&&null!=(_ref3=_ref2.discount)?_ref3.type:void 0)&&(basePrice=parseInt(pricing.price.base.plan.unit),$scope.normalPrice=basePrice,pricing.items.coupon.applies_for_months>0&&(null!=(_ref4=pricing.items.coupon)&&null!=(_ref5=_ref4.discount)?_ref5.rate:void 0)&&null!=(null!=(_ref6=pricing.items.coupon)?_ref6.applies_for_months:void 0)&&($scope.discountMonths=null!=(_ref7=pricing.items.coupon)?_ref7.applies_for_months:void 0,$scope.discountRate=100*(null!=(_ref8=pricing.items.coupon)&&null!=(_ref9=_ref8.discount)?_ref9.rate:void 0)),null!=(null!=(_ref10=pricing.price)&&null!=(_ref11=_ref10.taxes[0])?_ref11.rate:void 0)&&($scope.normalPrice+=basePrice*pricing.price.taxes[0].rate)),$scope.$apply()}}(this)),$scope.applyCoupon=function(){return pricing.coupon($scope.data.coupon).done()},$scope.applyVatNumber=function(){return pricing.tax({tax_code:"digital",vat_number:$scope.data.vat_number}).done()},$scope.changeCurrency=function(newCurrency){return $scope.currencyCode=newCurrency,pricing.currency(newCurrency).done()},$scope.updateExpiry=function(){var parsedDateObj;return parsedDateObj=ccUtils.parseExpiry($scope.data.mmYY),null!=parsedDateObj?($scope.data.month=parsedDateObj.month,$scope.data.year=parsedDateObj.year):void 0},$scope.validateCardNumber=validateCardNumber=function(){var _ref;return $scope.validation.errorFields={},0!==(null!=(_ref=$scope.data.number)?_ref.length:void 0)?$scope.validation.correctCardNumber=recurly.validate.cardNumber($scope.data.number):void 0},$scope.validateExpiry=validateExpiry=function(){var _ref,_ref1;return $scope.validation.errorFields={},0!==(null!=(_ref=$scope.data.month)?_ref.length:void 0)&&0!==(null!=(_ref1=$scope.data.year)?_ref1.length:void 0)?$scope.validation.correctExpiry=recurly.validate.expiry($scope.data.month,$scope.data.year):void 0},$scope.validateCvv=validateCvv=function(){var _ref;return $scope.validation.errorFields={},0!==(null!=(_ref=$scope.data.cvv)?_ref.length:void 0)?$scope.validation.correctCvv=recurly.validate.cvv($scope.data.cvv):void 0},$scope.inputHasError=inputHasError=function(formItem){return null==formItem?!1:formItem.$touched&&formItem.$invalid},$scope.isFormValid=isFormValid=function(form){return"paypal"===$scope.paymentMethod.value?""!==$scope.data.country:form.$valid&&$scope.validation.correctCardNumber&&$scope.validation.correctExpiry&&$scope.validation.correctCvv},$scope.updateCountry=function(){return pricing.address({country:$scope.data.country}).done()},$scope.setPaymentMethod=setPaymentMethod=function(method){return $scope.paymentMethod.value=method,$scope.validation.errorFields={},$scope.genericError=""},completeSubscription=function(err,recurly_token_id){var postData,_ref,_ref1;return $scope.validation.errorFields={},null!=err?(event_tracking.sendMB("subscription-error",err),$scope.$evalAsync(function(){return $scope.processing=!1,$scope.genericError=err.message,_.each(err.fields,function(field){return $scope.validation.errorFields[field]=!0})})):(postData={_csrf:window.csrfToken,recurly_token_id:recurly_token_id.id,subscriptionDetails:{currencyCode:pricing.items.currency,plan_code:pricing.items.plan.code,coupon_code:(null!=(_ref=pricing.items)&&null!=(_ref1=_ref.coupon)?_ref1.code:void 0)||"",isPaypal:"paypal"===$scope.paymentMethod.value,address:{address1:$scope.data.address1,address2:$scope.data.address2,country:$scope.data.country,state:$scope.data.state,postal_code:$scope.data.postal_code}}},event_tracking.sendMB("subscription-form-submitted",{currencyCode:postData.subscriptionDetails.currencyCode,plan_code:postData.subscriptionDetails.plan_code,coupon_code:postData.subscriptionDetails.coupon_code,isPaypal:postData.subscriptionDetails.isPaypal}),$http.post("/user/subscription/create",postData).success(function(data,status,headers){return event_tracking.sendMB("subscription-submission-success"),window.location.href="/user/subscription/thank-you"}).error(function(data,status,headers){return $scope.processing=!1,$scope.genericError="Something went wrong processing the request"}))},$scope.submit=function(){var opts;return $scope.processing=!0,"paypal"===$scope.paymentMethod.value?(opts={description:$scope.planName},recurly.paypal(opts,completeSubscription)):recurly.token($scope.data,completeSubscription)}})})}.call(this),function(){define("main/annual-upgrade",["base"],function(App){return App.controller("AnnualUpgradeController",function($scope,$http,$modal){var MESSAGES_URL,savings;return MESSAGES_URL="/user/subscription/upgrade-annual",$scope.upgradeComplete=!1,savings={student:"19.2",collaborator:"36"},$scope.$watch($scope.planName,function(){return $scope.yearlySaving=savings[$scope.planName],"annual"===$scope.planName?$scope.upgradeComplete=!0:void 0}),$scope.completeAnnualUpgrade=function(){var body;return body={planName:$scope.planName,_csrf:window.csrfToken},$scope.inflight=!0,$http.post(MESSAGES_URL,body).success(function(){return $scope.upgradeComplete=!0}).error(function(){return console.log("something went wrong changing plan")})}})})}.call(this),function(){define("main/announcements",["base"],function(App){return App.controller("AnnouncementsController",function($scope,$http,event_tracking,$window,_){var markAnnouncementsAsRead,refreshAnnouncements;return $scope.announcements=[],$scope.ui={isOpen:!1,newItems:0},refreshAnnouncements=function(){return $http.get("/announcements").success(function(announcements){return $scope.announcements=announcements,$scope.ui.newItems=_.filter(announcements,function(announcement){return!announcement.read}).length})},markAnnouncementsAsRead=function(){return event_tracking.sendMB("announcement-alert-dismissed",{blogPostId:$scope.announcements[0].id})},$scope.logAnnouncementClick=function(){return event_tracking.sendMB("announcement-read-more-clicked",{blogPostId:$scope.announcements[0].id})},refreshAnnouncements(),$scope.toggleAnnouncementsUI=function(){return $scope.ui.isOpen=!$scope.ui.isOpen,!$scope.ui.isOpen&&$scope.ui.newItems?($scope.ui.newItems=0,markAnnouncementsAsRead()):void 0},$scope.showAll=function(){return $scope.ui.newItems=0}})})}.call(this),function(){define("main/register-users",["base"],function(App){return App.controller("RegisterUsersController",function($scope,queuedHttp){var parseEmails;return $scope.users=[],$scope.inputs={emails:""},parseEmails=function(emailsString){var emails,regexBySpaceOrComma;return regexBySpaceOrComma=/[\s,]+/,emails=emailsString.split(regexBySpaceOrComma),emails=_.map(emails,function(email){return email=email.trim()}),emails=_.select(emails,function(email){return-1!==email.indexOf("@")})},$scope.registerUsers=function(){var email,emails,_i,_len,_results;for(emails=parseEmails($scope.inputs.emails),$scope.error=!1,_results=[],_i=0,_len=emails.length;_len>_i;_i++)email=emails[_i],_results.push(queuedHttp.post("/admin/register",{email:email,_csrf:window.csrfToken}).success(function(user){return $scope.users.push(user),$scope.inputs.emails=""}).error(function(){return $scope.error=!0}));return _results}})})}.call(this),function(){define("main/subscription/group-subscription-invite-controller",["base"],function(App){return App.controller("GroupSubscriptionInviteController",function($scope,$http){return $scope.inflight=!1,has_personal_subscription?$scope.view="personalSubscription":$scope.view="groupSubscriptionInvite",$scope.keepPersonalSubscription=function(){return $scope.view="groupSubscriptionInvite"},$scope.cancelSubscription=function(){var request;return $scope.inflight=!0,request=$http.post("/user/subscription/cancel",{_csrf:window.csrfToken}),request.success(function(data,status){return $scope.inflight=!1,$scope.view="groupSubscriptionInvite"}),request.error(function(data,status){return console.log("the request failed")})},$scope.joinGroup=function(){var request;return $scope.view="requestSent",$scope.inflight=!0,request=$http.post("/user/subscription/"+group_subscription_id+"/group/begin-join",{_csrf:window.csrfToken}),request.success(function(data,status){return $scope.inflight=!1,200!==status?$scope.requestSent=!1:void 0}),request.error(function(data,status){return console.log("the request failed")})}})})}.call(this),function(){"use strict";function capitalize(string){return string=String(string),string.charAt(0).toUpperCase()+string.slice(1)}function cleanupOS(os,pattern,label){var data={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"7 / Server 2008 R2","6.0":"Vista / Server 2008",5.2:"XP 64-bit / Server 2003",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return pattern&&label&&/^Win/i.test(os)&&!/^Windows Phone /i.test(os)&&(data=data[/[\d.]+$/.exec(os)])&&(os="Windows "+data),os=String(os),pattern&&label&&(os=os.replace(RegExp(pattern,"i"),label)),os=format(os.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function each(object,callback){var index=-1,length=object?object.length:0;if("number"==typeof length&&length>-1&&maxSafeInteger>=length)for(;++index<length;)callback(object[index],index,object);else forOwn(object,callback)}function format(string){return string=trim(string),/^(?:webOS|i(?:OS|P))/.test(string)?string:capitalize(string)}function forOwn(object,callback){for(var key in object)hasOwnProperty.call(object,key)&&callback(object[key],key,object)}function getClassOf(value){return null==value?capitalize(value):toString.call(value).slice(8,-1)}function isHostType(object,property){var type=null!=object?typeof object[property]:"number";return!/^(?:boolean|number|string|undefined)$/.test(type)&&("object"==type?!!object[property]:!0)}function qualify(string){return String(string).replace(/([ -])(?!$)/g,"$1?")}function reduce(array,callback){
var accumulator=null;return each(array,function(value,index){accumulator=callback(accumulator,value,index,array)}),accumulator}function trim(string){return String(string).replace(/^ +| +$/g,"")}function parse(ua){function getLayout(guesses){return reduce(guesses,function(result,guess){return result||RegExp("\\b"+(guess.pattern||qualify(guess))+"\\b","i").exec(ua)&&(guess.label||guess)})}function getManufacturer(guesses){return reduce(guesses,function(result,value,key){return result||(value[product]||value[/^[a-z]+(?: +[a-z]+\b)*/i.exec(product)]||RegExp("\\b"+qualify(key)+"(?:\\b|\\w*\\d)","i").exec(ua))&&key})}function getName(guesses){return reduce(guesses,function(result,guess){return result||RegExp("\\b"+(guess.pattern||qualify(guess))+"\\b","i").exec(ua)&&(guess.label||guess)})}function getOS(guesses){return reduce(guesses,function(result,guess){var pattern=guess.pattern||qualify(guess);return!result&&(result=RegExp("\\b"+pattern+"(?:/[\\d.]+|[ \\w.]*)","i").exec(ua))&&(result=cleanupOS(result,pattern,guess.label||guess)),result})}function getProduct(guesses){return reduce(guesses,function(result,guess){var pattern=guess.pattern||qualify(guess);return!result&&(result=RegExp("\\b"+pattern+" *\\d+[.\\w_]*","i").exec(ua)||RegExp("\\b"+pattern+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(ua))&&((result=String(guess.label&&!RegExp(pattern,"i").test(guess.label)?guess.label:result).split("/"))[1]&&!/[\d.]+/.test(result[0])&&(result[0]+=" "+result[1]),guess=guess.label||guess,result=format(result[0].replace(RegExp(pattern,"i"),guess).replace(RegExp("; *(?:"+guess+"[_-])?","i")," ").replace(RegExp("("+guess+")[-_.]?(\\w)","i"),"$1 $2"))),result})}function getVersion(patterns){return reduce(patterns,function(result,pattern){return result||(RegExp(pattern+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(ua)||0)[1]||null})}function toStringPlatform(){return this.description||""}var context=root,isCustomContext=ua&&"object"==typeof ua&&"String"!=getClassOf(ua);isCustomContext&&(context=ua,ua=null);var nav=context.navigator||{},userAgent=nav.userAgent||"";ua||(ua=userAgent);var data,isSpecialCasedOS,isModuleScope=isCustomContext||thisBinding==oldRoot,likeChrome=isCustomContext?!!nav.likeChrome:/\bChrome\b/.test(ua)&&!/internal|\n/i.test(toString.toString()),objectClass="Object",airRuntimeClass=isCustomContext?objectClass:"ScriptBridgingProxyObject",enviroClass=isCustomContext?objectClass:"Environment",javaClass=isCustomContext&&context.java?"JavaPackage":getClassOf(context.java),phantomClass=isCustomContext?objectClass:"RuntimeObject",java=/\bJava/.test(javaClass)&&context.java,rhino=java&&getClassOf(context.environment)==enviroClass,alpha=java?"a":"α",beta=java?"b":"β",doc=context.document||{},opera=context.operamini||context.opera,operaClass=reOpera.test(operaClass=isCustomContext&&opera?opera["[[Class]]"]:getClassOf(opera))?operaClass:opera=null,arch=ua,description=[],prerelease=null,useFeatures=ua==userAgent,version=useFeatures&&opera&&"function"==typeof opera.version&&opera.version(),layout=getLayout([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),name=getName(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt","SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox Mobile",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),product=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation 3","PlayStation 4","PlayStation Vita","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),manufacturer=getManufacturer({Apple:{iPad:1,iPhone:1,iPod:1},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{"PlayStation 4":1,"PlayStation 3":1,"PlayStation Vita":1}}),os=getOS(["Windows Phone ","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(layout&&(layout=[layout]),manufacturer&&!product&&(product=getProduct([manufacturer])),(data=/\bGoogle TV\b/.exec(product))&&(product=data[0]),/\bSimulator\b/i.test(ua)&&(product=(product?product+" ":"")+"Simulator"),"Opera Mini"==name&&/\bOPiOS\b/.test(ua)&&description.push("running in Turbo/Uncompressed mode"),/^iP/.test(product)?(name||(name="Safari"),os="iOS"+((data=/ OS ([\d_]+)/i.exec(ua))?" "+data[1].replace(/_/g,"."):"")):"Konqueror"!=name||/buntu/i.test(os)?manufacturer&&"Google"!=manufacturer&&(/Chrome/.test(name)&&!/\bMobile Safari\b/i.test(ua)||/\bVita\b/.test(product))?(name="Android Browser",os=/\bAndroid\b/.test(os)?os:"Android"):"Silk"==name?(/\bMobi/i.test(ua)||(os="Android",description.unshift("desktop mode")),/Accelerated *= *true/i.test(ua)&&description.unshift("accelerated")):"PaleMoon"==name&&(data=/\bFirefox\/([\d.]+)\b/.exec(ua))?description.push("identifying as Firefox "+data[1]):"Firefox"==name&&(data=/\b(Mobile|Tablet|TV)\b/i.exec(ua))?(os||(os="Firefox OS"),product||(product=data[1])):(!name||(data=!/\bMinefield\b/i.test(ua)&&/\b(?:Firefox|Safari)\b/.exec(name)))&&(name&&!product&&/[\/,]|^[^(]+?\)/.test(ua.slice(ua.indexOf(data+"/")+8))&&(name=null),(data=product||manufacturer||os)&&(product||manufacturer||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(os))&&(name=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(os)?os:data)+" Browser")):os="Kubuntu",version||(version=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|Silk(?!/[\\d.]+$))","Version",qualify(name),"(?:Firefox|Minefield|NetFront)"])),(data="iCab"==layout&&parseFloat(version)>3&&"WebKit"||/\bOpera\b/.test(name)&&(/\bOPR\b/.test(ua)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(ua)&&!/^(?:Trident|EdgeHTML)$/.test(layout)&&"WebKit"||!layout&&/\bMSIE\b/i.test(ua)&&("Mac OS"==os?"Tasman":"Trident")||"WebKit"==layout&&/\bPlayStation\b(?! Vita\b)/i.test(name)&&"NetFront")&&(layout=[data]),"IE"==name&&(data=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(ua)||0)[1])?(name+=" Mobile",os="Windows Phone "+(/\+$/.test(data)?data:data+".x"),description.unshift("desktop mode")):/\bWPDesktop\b/i.test(ua)?(name="IE Mobile",os="Windows Phone 8.x",description.unshift("desktop mode"),version||(version=(/\brv:([\d.]+)/.exec(ua)||0)[1])):"IE"!=name&&"Trident"==layout&&(data=/\brv:([\d.]+)/.exec(ua))&&(name&&description.push("identifying as "+name+(version?" "+version:"")),name="IE",version=data[1]),useFeatures){if(isHostType(context,"global"))if(java&&(data=java.lang.System,arch=data.getProperty("os.arch"),os=os||data.getProperty("os.name")+" "+data.getProperty("os.version")),isModuleScope&&isHostType(context,"system")&&(data=[context.system])[0]){os||(os=data[0].os||null);try{data[1]=context.require("ringo/engine").version,version=data[1].join("."),name="RingoJS"}catch(e){data[0].global.system==context.system&&(name="Narwhal")}}else"object"==typeof context.process&&(data=context.process)?(name="Node.js",arch=data.arch,os=data.platform,version=/[\d.]+/.exec(data.version)[0]):rhino&&(name="Rhino");else getClassOf(data=context.runtime)==airRuntimeClass?(name="Adobe AIR",os=data.flash.system.Capabilities.os):getClassOf(data=context.phantom)==phantomClass?(name="PhantomJS",version=(data=data.version||null)&&data.major+"."+data.minor+"."+data.patch):"number"==typeof doc.documentMode&&(data=/\bTrident\/(\d+)/i.exec(ua))&&(version=[version,doc.documentMode],(data=+data[1]+4)!=version[1]&&(description.push("IE "+version[1]+" mode"),layout&&(layout[1]=""),version[1]=data),version="IE"==name?String(version[1].toFixed(1)):version[0]);os=os&&format(os)}version&&(data=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(version)||/(?:alpha|beta)(?: ?\d)?/i.exec(ua+";"+(useFeatures&&nav.appMinorVersion))||/\bMinefield\b/i.test(ua)&&"a")&&(prerelease=/b/i.test(data)?"beta":"alpha",version=version.replace(RegExp(data+"\\+?$"),"")+("beta"==prerelease?beta:alpha)+(/\d+\+?/.exec(data)||"")),"Fennec"==name||"Firefox"==name&&/\b(?:Android|Firefox OS)\b/.test(os)?name="Firefox Mobile":"Maxthon"==name&&version?version=version.replace(/\.[\d.]+/,".x"):/\bXbox\b/i.test(product)?(os=null,"Xbox 360"==product&&/\bIEMobile\b/.test(ua)&&description.unshift("mobile mode")):!/^(?:Chrome|IE|Opera)$/.test(name)&&(!name||product||/Browser|Mobi/.test(name))||"Windows CE"!=os&&!/Mobi/i.test(ua)?"IE"==name&&useFeatures&&null===context.external?description.unshift("platform preview"):(/\bBlackBerry\b/.test(product)||/\bBB10\b/.test(ua))&&(data=(RegExp(product.replace(/ +/g," *")+"/([.\\d]+)","i").exec(ua)||0)[1]||version)?(data=[data,/BB10/.test(ua)],os=(data[1]?(product=null,manufacturer="BlackBerry"):"Device Software")+" "+data[0],version=null):this!=forOwn&&"Wii"!=product&&(useFeatures&&opera||/Opera/.test(name)&&/\b(?:MSIE|Firefox)\b/i.test(ua)||"Firefox"==name&&/\bOS X (?:\d+\.){2,}/.test(os)||"IE"==name&&(os&&!/^Win/.test(os)&&version>5.5||/\bWindows XP\b/.test(os)&&version>8||8==version&&!/\bTrident\b/.test(ua)))&&!reOpera.test(data=parse.call(forOwn,ua.replace(reOpera,"")+";"))&&data.name&&(data="ing as "+data.name+((data=data.version)?" "+data:""),reOpera.test(name)?(/\bIE\b/.test(data)&&"Mac OS"==os&&(os=null),data="identify"+data):(data="mask"+data,name=operaClass?format(operaClass.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(data)&&(os=null),useFeatures||(version=null)),layout=["Presto"],description.push(data)):name+=" Mobile",(data=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(ua)||0)[1])&&(data=[parseFloat(data.replace(/\.(\d)$/,".0$1")),data],"Safari"==name&&"+"==data[1].slice(-1)?(name="WebKit Nightly",prerelease="alpha",version=data[1].slice(0,-1)):(version==data[1]||version==(data[2]=(/\bSafari\/([\d.]+\+?)/i.exec(ua)||0)[1]))&&(version=null),data[1]=(/\bChrome\/([\d.]+)/i.exec(ua)||0)[1],537.36==data[0]&&537.36==data[2]&&parseFloat(data[1])>=28&&"WebKit"==layout&&(layout=["Blink"]),useFeatures&&(likeChrome||data[1])?(layout&&(layout[1]="like Chrome"),data=data[1]||(data=data[0],530>data?1:532>data?2:532.05>data?3:533>data?4:534.03>data?5:534.07>data?6:534.1>data?7:534.13>data?8:534.16>data?9:534.24>data?10:534.3>data?11:535.01>data?12:535.02>data?"13+":535.07>data?15:535.11>data?16:535.19>data?17:536.05>data?18:536.1>data?19:537.01>data?20:537.11>data?"21+":537.13>data?23:537.18>data?24:537.24>data?25:537.36>data?26:"Blink"!=layout?"27":"28")):(layout&&(layout[1]="like Safari"),data=data[0],data=400>data?1:500>data?2:526>data?3:533>data?4:534>data?"4+":535>data?5:537>data?6:538>data?7:601>data?8:"8"),layout&&(layout[1]+=" "+(data+="number"==typeof data?".x":/[.+]/.test(data)?"":"+")),"Safari"==name&&(!version||parseInt(version)>45)&&(version=data)),"Opera"==name&&(data=/\bzbov|zvav$/.exec(os))?(name+=" ",description.unshift("desktop mode"),"zvav"==data?(name+="Mini",version=null):name+="Mobile",os=os.replace(RegExp(" *"+data+"$"),"")):"Safari"==name&&/\bChrome\b/.exec(layout&&layout[1])&&(description.unshift("desktop mode"),name="Chrome Mobile",version=null,/\bOS X\b/.test(os)?(manufacturer="Apple",os="iOS 4.3+"):os=null),version&&0==version.indexOf(data=/[\d.]+$/.exec(os))&&ua.indexOf("/"+data+"-")>-1&&(os=trim(os.replace(data,""))),layout&&!/\b(?:Avant|Nook)\b/.test(name)&&(/Browser|Lunascape|Maxthon/.test(name)||"Safari"!=name&&/^iOS/.test(os)&&/\bSafari\b/.test(layout[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Sleipnir|Web)/.test(name)&&layout[1])&&(data=layout[layout.length-1])&&description.push(data),description.length&&(description=["("+description.join("; ")+")"]),manufacturer&&product&&product.indexOf(manufacturer)<0&&description.push("on "+manufacturer),product&&description.push((/^on /.test(description[description.length-1])?"":"on ")+product),os&&(data=/ ([\d.+]+)$/.exec(os)||(isSpecialCasedOS=/^[a-z]+ ([\d.+]+) \//i.exec(os)),os={architecture:32,family:data&&!isSpecialCasedOS?os.replace(data[0],""):os,version:data?data[1]:null,toString:function(){var version=this.version;return this.family+(version&&!isSpecialCasedOS?" "+version:"")+(64==this.architecture?" 64-bit":"")}}),(data=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(arch))&&!/\bi686\b/i.test(arch)&&(os&&(os.architecture=64,os.family=os.family.replace(RegExp(" *"+data),"")),name&&(/\bWOW64\b/i.test(ua)||useFeatures&&/\w(?:86|32)$/.test(nav.cpuClass||nav.platform)&&!/\bWin64; x64\b/i.test(ua))&&description.unshift("32-bit")),ua||(ua=null);var platform={};return platform.description=ua,platform.layout=layout&&layout[0],platform.manufacturer=manufacturer,platform.name=name,platform.prerelease=prerelease,platform.product=product,platform.ua=ua,platform.version=name&&version,platform.os=os||{architecture:null,family:null,version:null,toString:function(){return"null"}},platform.parse=parse,platform.toString=toStringPlatform,platform.version&&description.unshift(version),platform.name&&description.unshift(name),os&&name&&(os!=String(os).split(" ")[0]||os!=name.split(" ")[0]&&!product)&&description.push(product?"("+os+")":"on "+os),description.length&&(platform.description=description.join(" ")),platform}var objectTypes={"function":!0,object:!0},root=objectTypes[typeof window]&&window||this,oldRoot=root,freeExports=objectTypes[typeof exports]&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,freeGlobal=freeExports&&freeModule&&"object"==typeof global&&global;!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var maxSafeInteger=Math.pow(2,53)-1,reOpera=/\bOpera/,thisBinding=this,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,toString=objectProto.toString;"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("libs/platform",[],function(){return parse()}):freeExports&&freeModule?forOwn(parse(),function(value,key){freeExports[key]=value}):root.platform=parse()}.call(this),function(){define("services/algolia-search",["base"],function(App){return App.factory("algoliaSearch",function(){var client,kbIdx,service,wikiIdx,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8;return null!=(null!=(_ref=window.sharelatex)?_ref.algolia:void 0)&&null!=(null!=(_ref1=window.sharelatex.algolia)&&null!=(_ref2=_ref1.indexes)?_ref2.wiki:void 0)&&(client=new AlgoliaSearch(null!=(_ref3=window.sharelatex.algolia)?_ref3.app_id:void 0,null!=(_ref4=window.sharelatex.algolia)?_ref4.api_key:void 0),wikiIdx=client.initIndex(null!=(_ref5=window.sharelatex.algolia)&&null!=(_ref6=_ref5.indexes)?_ref6.wiki:void 0),kbIdx=client.initIndex(null!=(_ref7=window.sharelatex.algolia)&&null!=(_ref8=_ref7.indexes)?_ref8.kb:void 0)),service={searchWiki:wikiIdx.search.bind(wikiIdx),searchKB:kbIdx.search.bind(kbIdx)}})})}.call(this),function(){define("main/contact-us",["base","libs/platform","services/algolia-search"],function(App,platform){return App.controller("ContactModal",function($scope,$modal){return $scope.contactUsModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"supportModalTemplate",controller:"SupportModalController"})}}),App.controller("SupportModalController",function($scope,$modalInstance,algoliaSearch,event_tracking){var _handleSearchResults;return $scope.form={},$scope.sent=!1,$scope.sending=!1,$scope.suggestions=[],_handleSearchResults=function(success,results){var hit,page_underscored,suggestion,suggestions;return suggestions=function(){var _i,_len,_ref,_results;for(_ref=results.hits,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)hit=_ref[_i],page_underscored=hit.pageName.replace(/\s/g,"_"),_results.push(suggestion={url:"/learn/kb/"+page_underscored,name:hit._highlightResult.pageName.value});return _results}(),results.hits.length&&event_tracking.sendMB("contact-form-suggestions-shown"),$scope.$applyAsync(function(){return $scope.suggestions=suggestions})},$scope.contactUs=function(){var message,params,ticketNumber,_ref,_ref1;return null==$scope.form.email?void console.log("email not set"):($scope.sending=!0,ticketNumber=Math.floor(65536*(1+Math.random())).toString(32),message=$scope.form.message,null!=$scope.form.project_url&&(message=""+message+"\n\n project_url = "+$scope.form.project_url),params={email:$scope.form.email,message:message||"",subject:$scope.form.subject+(" - ["+ticketNumber+"]"),labels:"support",about:"<div>browser: "+(null!=platform?platform.name:void 0)+" "+(null!=platform?platform.version:void 0)+"</div> <div>os: "+(null!=platform&&null!=(_ref=platform.os)?_ref.family:void 0)+" "+(null!=platform&&null!=(_ref1=platform.os)?_ref1.version:void 0)+"</div>"},Groove.createTicket(params,function(err,json){return $scope.sent=!0,$scope.$apply()}))},$scope.$watch("form.subject",function(newVal,oldVal){return newVal&&newVal!==oldVal&&newVal.length>3?algoliaSearch.searchKB(newVal,_handleSearchResults,{hitsPerPage:3,typoTolerance:"strict"}):$scope.suggestions=[]}),$scope.clickSuggestionLink=function(url){return event_tracking.sendMB("contact-form-suggestions-clicked",{url:url})},$scope.close=function(){return $modalInstance.close()}}),App.controller("UniverstiesContactController",function($scope,$modal){return $scope.form={},$scope.sent=!1,$scope.sending=!1,$scope.contactUs=function(){var params,ticketNumber;return null==$scope.form.email?void console.log("email not set"):($scope.sending=!0,ticketNumber=Math.floor(65536*(1+Math.random())).toString(32),params={name:$scope.form.name||$scope.form.email,email:$scope.form.email,labels:""+$scope.form.source+" accounts",message:"Please contact me with more details",subject:$scope.form.subject+(" - ["+ticketNumber+"]"),about:""+($scope.form.position||"")+" "+($scope.form.university||"")},Groove.createTicket(params,function(err,json){return $scope.sent=!0,$scope.$apply()}))}})})}.call(this),function(){define("main/learn",["base","services/algolia-search"],function(App){return App.controller("SearchWikiController",function($scope,algoliaSearch,_,$modal){var buildHitViewModel,updateHits;return $scope.hits=[],$scope.clearSearchText=function(){return $scope.searchQueryText="",updateHits([])},$scope.safeApply=function(fn){var phase;return phase=$scope.$root.$$phase,"$apply"===phase||"$digest"===phase?$scope.$eval(fn):$scope.$apply(fn)},buildHitViewModel=function(hit){var content,line,lines,matching_lines,page_underscored,result,section_underscored,_i,_len;for(page_underscored=hit.pageName.replace(/\s/g,"_"),section_underscored=hit.sectionName.replace(/\s/g,"_"),content=hit._highlightResult.content.value,content=content.replace(/\n\n+/g,"\n\n"),lines=content.split("\n"),matching_lines=[],_i=0,_len=lines.length;_len>_i;_i++)line=lines[_i],line.match(/^\[edit\]/)||(content+=line+"\n",line.match(/<em>/)&&matching_lines.push(line));return content=matching_lines.join("\n...\n"),result={name:hit._highlightResult.pageName.value+" - "+hit._highlightResult.sectionName.value,url:"/learn/"+page_underscored+"#"+section_underscored,content:content}},updateHits=function(hits){return $scope.safeApply(function(){return $scope.hits=hits})},$scope.search=function(){var query;return query=$scope.searchQueryText,null==query||0===query.length?void updateHits([]):algoliaSearch.searchWiki(query,function(err,response){var hits;return 0===response.hits.length?updateHits([]):(hits=_.map(response.hits,buildHitViewModel),updateHits(hits))})},$scope.showMissingTemplateModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"missingWikiPageModal",controller:"MissingWikiPageController"})}}),App.controller("MissingWikiPageController",function($scope,$modalInstance){return $scope.form={},$scope.sent=!1,$scope.sending=!1,$scope.contactUs=function(){var params,ticketNumber;return null==$scope.form.message?void console.log("message not set"):($scope.sending=!0,ticketNumber=Math.floor(65536*(1+Math.random())).toString(32),params={email:$scope.form.email||"support@sharelatex.com",message:$scope.form.message||"",subject:"new wiki page sujection - ["+ticketNumber+"]",labels:"support wiki"},Groove.createTicket(params,function(err,json){return $scope.sent=!0,$scope.$apply()}))},$scope.close=function(){return $modalInstance.close()}})})}.call(this);var CryptoJS=CryptoJS||function(s,p){var m={},l=m.lib={},n=function(){},r=l.Base={extend:function(b){n.prototype=this;var h=new n;return b&&h.mixIn(b),h.hasOwnProperty("init")||(h.init=function(){h.$super.init.apply(this,arguments)}),h.init.prototype=h,h.$super=this,h},create:function(){var b=this.extend();return b.init.apply(b,arguments),b},init:function(){},mixIn:function(b){for(var h in b)b.hasOwnProperty(h)&&(this[h]=b[h]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},q=l.WordArray=r.extend({init:function(b,h){b=this.words=b||[],this.sigBytes=h!=p?h:4*b.length},toString:function(b){return(b||t).stringify(this)},concat:function(b){var h=this.words,a=b.words,j=this.sigBytes;if(b=b.sigBytes,this.clamp(),j%4)for(var g=0;b>g;g++)h[j+g>>>2]|=(a[g>>>2]>>>24-8*(g%4)&255)<<24-8*((j+g)%4);else if(65535<a.length)for(g=0;b>g;g+=4)h[j+g>>>2]=a[g>>>2];else h.push.apply(h,a);return this.sigBytes+=b,this},clamp:function(){var b=this.words,h=this.sigBytes;b[h>>>2]&=4294967295<<32-8*(h%4),b.length=s.ceil(h/4)},clone:function(){var b=r.clone.call(this);return b.words=this.words.slice(0),b},random:function(b){for(var h=[],a=0;b>a;a+=4)h.push(4294967296*s.random()|0);return new q.init(h,b)}}),v=m.enc={},t=v.Hex={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;b>j;j++){var k=a[j>>>2]>>>24-8*(j%4)&255;g.push((k>>>4).toString(16)),g.push((15&k).toString(16))}return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;a>j;j+=2)g[j>>>3]|=parseInt(b.substr(j,2),16)<<24-4*(j%8);return new q.init(g,a/2)}},a=v.Latin1={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;b>j;j++)g.push(String.fromCharCode(a[j>>>2]>>>24-8*(j%4)&255));return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;a>j;j++)g[j>>>2]|=(255&b.charCodeAt(j))<<24-8*(j%4);return new q.init(g,a)}},u=v.Utf8={stringify:function(b){try{return decodeURIComponent(escape(a.stringify(b)))}catch(g){throw Error("Malformed UTF-8 data")}},parse:function(b){return a.parse(unescape(encodeURIComponent(b)))}},g=l.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new q.init,this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=u.parse(b)),this._data.concat(b),this._nDataBytes+=b.sigBytes},_process:function(b){var a=this._data,g=a.words,j=a.sigBytes,k=this.blockSize,m=j/(4*k),m=b?s.ceil(m):s.max((0|m)-this._minBufferSize,0);if(b=m*k,j=s.min(4*b,j),b){for(var l=0;b>l;l+=k)this._doProcessBlock(g,l);l=g.splice(0,b),a.sigBytes-=j}return new q.init(l,j)},clone:function(){var b=r.clone.call(this);return b._data=this._data.clone(),b},_minBufferSize:0});l.Hasher=g.extend({cfg:r.extend(),init:function(b){this.cfg=this.cfg.extend(b),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(b){return this._append(b),this._process(),this},finalize:function(b){return b&&this._append(b),this._doFinalize()},blockSize:16,_createHelper:function(b){return function(a,g){return new b.init(g).finalize(a)}},_createHmacHelper:function(b){return function(a,g){return new k.HMAC.init(b,g).finalize(a)}}});var k=m.algo={};return m}(Math);!function(s){function p(a,k,b,h,l,j,m){return a=a+(k&b|~k&h)+l+m,(a<<j|a>>>32-j)+k}function m(a,k,b,h,l,j,m){return a=a+(k&h|b&~h)+l+m,(a<<j|a>>>32-j)+k}function l(a,k,b,h,l,j,m){return a=a+(k^b^h)+l+m,(a<<j|a>>>32-j)+k}function n(a,k,b,h,l,j,m){return a=a+(b^(k|~h))+l+m,(a<<j|a>>>32-j)+k}for(var r=CryptoJS,q=r.lib,v=q.WordArray,t=q.Hasher,q=r.algo,a=[],u=0;64>u;u++)a[u]=4294967296*s.abs(s.sin(u+1))|0;q=q.MD5=t.extend({_doReset:function(){this._hash=new v.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(g,k){for(var b=0;16>b;b++){var h=k+b,w=g[h];g[h]=16711935&(w<<8|w>>>24)|4278255360&(w<<24|w>>>8)}var b=this._hash.words,h=g[k+0],w=g[k+1],j=g[k+2],q=g[k+3],r=g[k+4],s=g[k+5],t=g[k+6],u=g[k+7],v=g[k+8],x=g[k+9],y=g[k+10],z=g[k+11],A=g[k+12],B=g[k+13],C=g[k+14],D=g[k+15],c=b[0],d=b[1],e=b[2],f=b[3],c=p(c,d,e,f,h,7,a[0]),f=p(f,c,d,e,w,12,a[1]),e=p(e,f,c,d,j,17,a[2]),d=p(d,e,f,c,q,22,a[3]),c=p(c,d,e,f,r,7,a[4]),f=p(f,c,d,e,s,12,a[5]),e=p(e,f,c,d,t,17,a[6]),d=p(d,e,f,c,u,22,a[7]),c=p(c,d,e,f,v,7,a[8]),f=p(f,c,d,e,x,12,a[9]),e=p(e,f,c,d,y,17,a[10]),d=p(d,e,f,c,z,22,a[11]),c=p(c,d,e,f,A,7,a[12]),f=p(f,c,d,e,B,12,a[13]),e=p(e,f,c,d,C,17,a[14]),d=p(d,e,f,c,D,22,a[15]),c=m(c,d,e,f,w,5,a[16]),f=m(f,c,d,e,t,9,a[17]),e=m(e,f,c,d,z,14,a[18]),d=m(d,e,f,c,h,20,a[19]),c=m(c,d,e,f,s,5,a[20]),f=m(f,c,d,e,y,9,a[21]),e=m(e,f,c,d,D,14,a[22]),d=m(d,e,f,c,r,20,a[23]),c=m(c,d,e,f,x,5,a[24]),f=m(f,c,d,e,C,9,a[25]),e=m(e,f,c,d,q,14,a[26]),d=m(d,e,f,c,v,20,a[27]),c=m(c,d,e,f,B,5,a[28]),f=m(f,c,d,e,j,9,a[29]),e=m(e,f,c,d,u,14,a[30]),d=m(d,e,f,c,A,20,a[31]),c=l(c,d,e,f,s,4,a[32]),f=l(f,c,d,e,v,11,a[33]),e=l(e,f,c,d,z,16,a[34]),d=l(d,e,f,c,C,23,a[35]),c=l(c,d,e,f,w,4,a[36]),f=l(f,c,d,e,r,11,a[37]),e=l(e,f,c,d,u,16,a[38]),d=l(d,e,f,c,y,23,a[39]),c=l(c,d,e,f,B,4,a[40]),f=l(f,c,d,e,h,11,a[41]),e=l(e,f,c,d,q,16,a[42]),d=l(d,e,f,c,t,23,a[43]),c=l(c,d,e,f,x,4,a[44]),f=l(f,c,d,e,A,11,a[45]),e=l(e,f,c,d,D,16,a[46]),d=l(d,e,f,c,j,23,a[47]),c=n(c,d,e,f,h,6,a[48]),f=n(f,c,d,e,u,10,a[49]),e=n(e,f,c,d,C,15,a[50]),d=n(d,e,f,c,s,21,a[51]),c=n(c,d,e,f,A,6,a[52]),f=n(f,c,d,e,q,10,a[53]),e=n(e,f,c,d,y,15,a[54]),d=n(d,e,f,c,w,21,a[55]),c=n(c,d,e,f,v,6,a[56]),f=n(f,c,d,e,D,10,a[57]),e=n(e,f,c,d,t,15,a[58]),d=n(d,e,f,c,B,21,a[59]),c=n(c,d,e,f,r,6,a[60]),f=n(f,c,d,e,z,10,a[61]),e=n(e,f,c,d,j,15,a[62]),d=n(d,e,f,c,x,21,a[63]);b[0]=b[0]+c|0,b[1]=b[1]+d|0,b[2]=b[2]+e|0,b[3]=b[3]+f|0},_doFinalize:function(){var a=this._data,k=a.words,b=8*this._nDataBytes,h=8*a.sigBytes;k[h>>>5]|=128<<24-h%32;var l=s.floor(b/4294967296);for(k[(h+64>>>9<<4)+15]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),k[(h+64>>>9<<4)+14]=16711935&(b<<8|b>>>24)|4278255360&(b<<24|b>>>8),a.sigBytes=4*(k.length+1),this._process(),a=this._hash,k=a.words,b=0;4>b;b++)h=k[b],k[b]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8);return a},clone:function(){var a=t.clone.call(this);return a._hash=this._hash.clone(),a}}),r.MD5=t._createHelper(q),r.HmacMD5=t._createHmacHelper(q)}(Math),define("libs/md5",function(){}),function(){define("analytics/AbTestingManager",["base","libs/md5"],function(App){var oldKeys;return oldKeys=["sl_abt_multi_currency_editor_eu-eu","sl_abt_multi_currency_eu-eu","sl_abt_multi_currency_editor_eu-usd","sl_abt_multi_currency_eu-usd","sl_abt_trial_len_14d","sl_abt_trial_len_7d","sl_abt_trial_len_30d","sl_utt","sl_utt_trial_len","sl_utt_multi_currency"],App.factory("abTestManager",function($http,ipCookie){var getABTestBucket,processTestWithStep,_buildCookieKey,_checkIfStepIsNext,_getTestCookie,_getUsersHash,_persistCookieStep;return _.each(oldKeys,function(oldKey){return ipCookie.remove(oldKey)}),_buildCookieKey=function(testName,bucket){var key;return key="sl_abt_"+testName+"_"+bucket},_getTestCookie=function(testName,bucket){var cookie,cookieKey;return cookieKey=_buildCookieKey(testName,bucket),cookie=ipCookie(cookieKey)},_persistCookieStep=function(testName,bucket,newStep){var cookieKey;return cookieKey=_buildCookieKey(testName,bucket),ipCookie(cookieKey,{step:newStep},{expires:100,path:"/"}),ga("send","event","ab_tests",""+testName+":"+bucket,"step-"+newStep)},_checkIfStepIsNext=function(cookieStep,newStep){return null==cookieStep&&0!==newStep?!1:0===newStep?!0:cookieStep+1===newStep?!0:!1},_getUsersHash=function(testName){var hash,sl_user_test_token,user_uuid;return sl_user_test_token="sl_utt_"+testName,user_uuid=ipCookie(sl_user_test_token),null==user_uuid&&(user_uuid=Math.random(),ipCookie(sl_user_test_token,user_uuid,{expires:365,path:"/"})),hash=CryptoJS.MD5(""+user_uuid+":"+testName)},{processTestWithStep:processTestWithStep=function(testName,bucket,newStep){var currentCookieStep,_ref;return currentCookieStep=null!=(_ref=_getTestCookie(testName,bucket))?_ref.step:void 0,_checkIfStepIsNext(currentCookieStep,newStep)?_persistCookieStep(testName,bucket,newStep):void 0},getABTestBucket:getABTestBucket=function(test_name,buckets){var bucketIndex,hash;return hash=_getUsersHash(test_name),bucketIndex=parseInt(hash.toString().slice(0,2),16)%((null!=buckets?buckets.length:void 0)||2),buckets[bucketIndex]}}}),App.controller("AbTestController",function($scope,abTestManager){var testKeys;return testKeys=_.keys(window.ab),_.each(window.ab,function(event){return abTestManager.processTestWithStep(event.testName,event.bucket,event.step)})})})}.call(this),function(){define("directives/asyncForm",["base","libs/passfield"],function(App){return App.directive("asyncForm",function($http){return{controller:["$scope",function($scope){return this.getEmail=function(){return $scope.email},this}],link:function(scope,element,attrs){var formName,response;return formName=attrs.asyncForm,scope[attrs.name].response=response={},scope[attrs.name].inflight=!1,element.on("submit",function(e){var data,formData,_i,_len,_ref;for(e.preventDefault(),formData={},_ref=element.serializeArray(),_i=0,_len=_ref.length;_len>_i;_i++)data=_ref[_i],formData[data.name]=data.value;return scope[attrs.name].inflight=!0,$http.post(element.attr("action"),formData,{disableAutoLoginRedirect:!0}).success(function(data,status,headers,config){var onSuccessHandler;return scope[attrs.name].inflight=!1,response.success=!0,response.error=!1,onSuccessHandler=scope[attrs.onSuccess],onSuccessHandler?void onSuccessHandler(data,status,headers,config):null!=data.redir?(ga("send","event",formName,"success"),window.location=data.redir):null!=data.message?(response.message=data.message,"error"===data.message.type?(response.success=!1,response.error=!0,ga("send","event",formName,"failure",data.message)):ga("send","event",formName,"success")):void 0}).error(function(data,status,headers,config){var onErrorHandler,_ref1;return scope[attrs.name].inflight=!1,response.success=!1,response.error=!0,(onErrorHandler=scope[attrs.onError])?void onErrorHandler(data,status,headers,config):(403===status?response.message={text:"Session error. Please check you have cookies enabled. If the problem persists, try clearing your cache and cookies.",type:"error"}:response.message={text:(null!=(_ref1=data.message)?_ref1.text:void 0)||data.message||"Something went wrong talking to the server :(. Please try again.",type:"error"},ga("send","event",formName,"failure",data.message))})})}}}),App.directive("formMessages",function(){return{restrict:"E",template:"<div class=\"alert\" ng-class=\"{\n	'alert-danger': form.response.message.type == 'error',\n	'alert-success': form.response.message.type != 'error'\n}\" ng-show=\"!!form.response.message\">\n	{{form.response.message.text}}\n</div>\n<div ng-transclude></div>",
transclude:!0,scope:{form:"=for"}}}),App.directive("complexPassword",function(){return{require:["^asyncForm","ngModel"],link:function(scope,element,attrs,ctrl){var asyncFormCtrl,defaultPasswordOpts,ngModelCtrl,opts,passField;return PassField.Config.blackList=[],defaultPasswordOpts={pattern:"",length:{min:1,max:50},allowEmpty:!1,allowAnyChars:!1,isMasked:!0,showToggle:!1,showGenerate:!1,showTip:!1,showWarn:!1,checkMode:PassField.CheckModes.STRICT,chars:{digits:"1234567890",letters:"abcdefghijklmnopqrstuvwxyz",letters_up:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",symbols:"@#$%^&*()-_=+[]{};:<>/?!£€.,"}},opts=_.defaults(window.passwordStrengthOptions||{},defaultPasswordOpts),1===opts.length.min&&(opts.acceptRate=0),passField=new PassField.Field("passwordField",opts),asyncFormCtrl=ctrl[0],ngModelCtrl=ctrl[1],ngModelCtrl.$parsers.unshift(function(modelValue){var email,isValid,startOfEmail,_ref;return isValid=passField.validatePass(),email=asyncFormCtrl.getEmail()||window.usersEmail,isValid?null!=email&&""!==email&&(startOfEmail=null!=email&&null!=(_ref=email.split("@"))?_ref[0]:void 0,(-1!==modelValue.indexOf(email)||-1!==modelValue.indexOf(startOfEmail))&&(isValid=!1,scope.complexPasswordErrorMessage="Password can not contain email address")):scope.complexPasswordErrorMessage=passField.getPassValidationMessage(),null!=opts.length.max&&modelValue.length===opts.length.max&&(isValid=!1,scope.complexPasswordErrorMessage="Maximum password length "+opts.length.max+" reached"),ngModelCtrl.$setValidity("complexPassword",isValid),modelValue})}}})})}.call(this),function(){define("directives/stopPropagation",["base"],function(App){return App.directive("stopPropagation",function($http){return{restrict:"A",link:function(scope,element,attrs){return element.bind(attrs.stopPropagation,function(e){return e.stopPropagation()})}}}),App.directive("preventDefault",function($http){return{restrict:"A",link:function(scope,element,attrs){return element.bind(attrs.preventDefault,function(e){return e.preventDefault()})}}})})}.call(this),function(){define("directives/focus",["base"],function(App){var selectName;return App.directive("focusWhen",function($timeout){return{restrict:"A",link:function(scope,element,attr){return scope.$watch(attr.focusWhen,function(value){return value?$timeout(function(){return element.focus()}):void 0})}}}),App.directive("focusOn",function($timeout){return{restrict:"A",link:function(scope,element,attrs){return scope.$on(attrs.focusOn,function(){return element.focus()})}}}),App.directive("selectWhen",function($timeout){return{restrict:"A",link:function(scope,element,attr){return scope.$watch(attr.selectWhen,function(value){return value?$timeout(function(){return element.select()}):void 0})}}}),App.directive("selectOn",function($timeout){return{restrict:"A",link:function(scope,element,attrs){return scope.$on(attrs.selectOn,function(){return element.select()})}}}),App.directive("selectNameWhen",function($timeout){return{restrict:"A",link:function(scope,element,attrs){return scope.$watch(attrs.selectNameWhen,function(value){return value?$timeout(function(){return selectName(element)}):void 0})}}}),App.directive("selectNameOn",function(){return{restrict:"A",link:function(scope,element,attrs){return scope.$on(attrs.selectNameOn,function(){return selectName(element)})}}}),App.directive("focus",function($timeout){return{scope:{trigger:"@focus"},link:function(scope,element){return scope.$watch("trigger",function(value){return"true"===value?$timeout(function(){return element[0].focus()}):void 0})}}}),selectName=function(element){var name,selectionEnd;return element.focus(),name=element.val(),null!=element[0].setSelectionRange?(selectionEnd=name.lastIndexOf("."),-1===selectionEnd&&(selectionEnd=name.length),element[0].setSelectionRange(0,selectionEnd)):void 0}})}.call(this),function(){define("directives/equals",["base"],function(App){return App.directive("equals",[function(){return{require:"ngModel",link:function(scope,elem,attrs,ctrl){var firstField;return firstField="#"+attrs.equals,elem.add(firstField).on("keyup",function(){return scope.$apply(function(){var equal;return equal=elem.val()===$(firstField).val(),ctrl.$setValidity("areEqual",equal)})})}}}])})}.call(this),function(){define("directives/fineUpload",["base"],function(App){return App.directive("fineUpload",function($timeout){return{scope:{multiple:"=",endpoint:"@",waitingForResponseText:"@",failedUploadText:"@",uploadButtonText:"@",dragAreaText:"@",hintText:"@",allowedExtensions:"=",onCompleteCallback:"=",onUploadCallback:"=",onValidateBatch:"=",onErrorCallback:"=",onSubmitCallback:"=",onCancelCallback:"=",autoUpload:"=",params:"=",control:"="},link:function(scope,element,attrs){var autoUpload,dragAreaText,endpoint,hintText,maxConnections,multiple,onCancel,onComplete,onError,onSubmit,onUpload,onValidateBatch,params,q,text,validation,_ref;return multiple=scope.multiple||!1,endpoint=scope.endpoint,validation=null!=scope.allowedExtensions?{allowedExtensions:scope.allowedExtensions}:{},text={waitingForResponse:scope.waitingForResponseText||"Processing...",failUpload:scope.failedUploadText||"Failed :(",uploadButton:scope.uploadButtonText||"Upload"},dragAreaText=scope.dragAreaText||"drag here",hintText=scope.hintText||"",maxConnections=scope.maxConnections||1,onComplete=scope.onCompleteCallback||function(){},onUpload=scope.onUploadCallback||function(){},onError=scope.onErrorCallback||function(){},onValidateBatch=scope.onValidateBatch||function(){},onSubmit=scope.onSubmitCallback||function(){},onCancel=scope.onCancelCallback||function(){},autoUpload=null==scope.autoUpload?!0:scope.autoUpload,params=scope.params||{},params._csrf=window.csrfToken,q=new qq.FineUploader({element:element[0],multiple:multiple,autoUpload:autoUpload,disabledCancelForFormUploads:!0,validation:validation,maxConnections:maxConnections,request:{endpoint:endpoint,forceMultipart:!0,params:params,paramsInBody:!1},callbacks:{onComplete:onComplete,onUpload:onUpload,onValidateBatch:onValidateBatch,onError:onError,onSubmit:onSubmit,onCancel:onCancel},text:text,template:'<div class="qq-uploader">\n	<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>\n	<div class="qq-upload-button btn btn-primary btn-lg">\n		<div>{uploadButtonText}</div>\n	</div>\n	<span class="or btn-lg"> or </span>\n	<span class="drag-here btn-lg">'+dragAreaText+'</span>\n	<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>\n	<div class="small">'+hintText+'</div>\n	<ul class="qq-upload-list"></ul>\n</div>'}),window.q=q,null!=(_ref=scope.control)&&(_ref.q=q),q}}})})}.call(this),function(){define("directives/onEnter",["base"],function(App){return App.directive("onEnter",function(){return function(scope,element,attrs){return element.bind("keydown keypress",function(event){return 13===event.which?(scope.$apply(function(){return scope.$eval(attrs.onEnter,{event:event})}),event.preventDefault()):void 0})}})})}.call(this),function(){define("directives/selectAll",["base"],function(App){return App.directive("selectAllList",function(){return{controller:["$scope",function($scope){return this.selectAll=function(){return $scope.$broadcast("select-all:select")},this.deselectAll=function(){return $scope.$broadcast("select-all:deselect")},this.clearSelectAllState=function(){return $scope.$broadcast("select-all:clear")}}],link:function(scope,element,attrs){}}}),App.directive("selectAll",function(){return{require:"^selectAllList",link:function(scope,element,attrs,selectAllListController){return scope.$on("select-all:clear",function(){return element.prop("checked",!1)}),element.change(function(){return element.is(":checked")?selectAllListController.selectAll():selectAllListController.deselectAll(),!0})}}}),App.directive("selectIndividual",function(){return{require:"^selectAllList",scope:{ngModel:"="},link:function(scope,element,attrs,selectAllListController){var ignoreChanges;return ignoreChanges=!1,scope.$watch("ngModel",function(value){return null==value||ignoreChanges?void 0:selectAllListController.clearSelectAllState()}),scope.$on("select-all:select",function(){return ignoreChanges=!0,scope.$apply(function(){return scope.ngModel=!0}),ignoreChanges=!1}),scope.$on("select-all:deselect",function(){return ignoreChanges=!0,scope.$apply(function(){return scope.ngModel=!1}),ignoreChanges=!1}),scope.$on("select-all:row-clicked",function(){return ignoreChanges=!0,scope.$apply(function(){return scope.ngModel=!scope.ngModel}),ignoreChanges=!1})}}}),App.directive("selectRow",function(){return{scope:!0,link:function(scope,element,attrs){return element.on("click",function(e){return scope.$broadcast("select-all:row-clicked")})}}})})}.call(this),function(){define("directives/maxHeight",["base"],function(App){return App.directive("maxHeight",function(){return{restrict:"A",link:function(scope,element,attrs){return scope.$watch(attrs.maxHeight,function(value){return null!=value?element.css({"max-height":value}):void 0})}}})})}.call(this),function(){define("filters/formatDate",["base","moment"],function(App,moment){return moment.locale("en",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"ddd, Do MMM YY",nextWeek:"ddd, Do MMM YY",sameElse:"ddd, Do MMM YY"}}),App.filter("formatDate",function(){return function(date,format){return null==format&&(format="Do MMM YYYY, h:mm a"),moment(date).format(format)}}),App.filter("relativeDate",function(){return function(date){return moment(date).calendar()}})})}.call(this),function(){define("main/admin-panel/controllers/AdminPanelController",["base"],function(App){return App.controller("AdminPanelController",function($scope,$http,$timeout,$window,$modal,queuedHttp){var recalculateUserListHeight,sendSearch;return $scope.users=window.data.users,$scope.pages=window.data.pages,$scope.allSelected=!1,$scope.selectedUsers=[],$scope.predicate="first_name",$scope.reverse=!1,$scope.timer,$scope.pageSelected=1,recalculateUserListHeight=function(){var bottomOffset,height,sideBarHeight,topOffset;return topOffset=$(".user-list-card").offset().top,bottomOffset=$("footer").outerHeight()+25,sideBarHeight=$("aside").height()-56,height=$window.innerHeight-topOffset-bottomOffset,sideBarHeight>height&&(height=Math.min(sideBarHeight,$window.innerHeight-topOffset-25)),$scope.userListHeight=height},$timeout(function(){return recalculateUserListHeight()},0),angular.element($window).bind("resize",function(){return recalculateUserListHeight(),$scope.$apply()}),sendSearch=function(){var request;return data._csrf=window.csrfToken,data.query=$scope.searchText,data.page=$scope.pageSelected,data.sort=$scope.predicate,data.reverse=$scope.reverse,request=$http.post("/admin/user/search",data),request.success(function(data,status){return $scope.users=data.users,$scope.pages=data.pages,$scope.updateVisibleUsers()}),request.error(function(data,status){return console.log("the request failed")})},$scope.clearSearchText=function(){return $scope.searchText="",$scope.$emit("search:clear"),sendSearch()},$scope.searchUsers=function(){return $scope.pageSelected=1,$timeout.cancel($scope.timer),$scope.timer=$timeout(function(){return sendSearch()},700)},$scope.changePage=function(page){return $scope.pageSelected=page,sendSearch()},$scope.updateSelectedUsers=function(){return $scope.selectedUsers=$scope.users.filter(function(user){return user.selected})},$scope.updateVisibleUsers=function(){var user,visible,_i,_len,_ref;for($scope.visibleUsers=[],_ref=$scope.users,_i=0,_len=_ref.length;_len>_i;_i++)user=_ref[_i],visible=!0,visible?$scope.visibleUsers.push(user):user.selected=!1;return $scope.updatePages()},$scope.getSelectedUsers=function(){return $scope.selectedUsers},$scope.getFirstSelectedUser=function(){return $scope.selectedUsers[0]},$scope.updatePages=function(){var i,_i,_ref,_results;if($scope.pagesList=[],$scope.pages>1){for(_results=[],i=_i=1,_ref=$scope.pages;_ref>=1?_ref>=_i:_i>=_ref;i=_ref>=1?++_i:--_i)_results.push($scope.pagesList.push(i));return _results}},$scope.changePredicate=function(newPredicate){return $scope.predicate===newPredicate&&($scope.reverse=!$scope.reverse),$scope.predicate=newPredicate,sendSearch()},$scope.getSortIconClass=function(column){return column===$scope.predicate&&$scope.reverse?"fa-caret-down":column!==$scope.predicate||$scope.reverse?"":"fa-caret-up"},$scope._removeUserFromList=function(user){var index;return index=$scope.users.indexOf(user),index>-1?$scope.users.splice(index,1):void 0},$scope.openDeleteUsersModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"deleteUsersModalTemplate",controller:"DeleteUsersModalController",resolve:{users:function(){return $scope.getSelectedUsers()}}}),modalInstance.result.then(function(){return $scope.DeleteSelectedUsers()})},$scope.DeleteSelectedUsers=function(){var selected_users,user,_i,_len;for(selected_users=$scope.getSelectedUsers(),_i=0,_len=selected_users.length;_len>_i;_i++)user=selected_users[_i],$scope._removeUserFromList(user),queuedHttp({method:"DELETE",url:"/admin/user/"+user._id,headers:{"X-CSRF-Token":window.csrfToken}});return $scope.searchUsers()},$scope.openSetPasswordModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"setPasswordModalTemplate",controller:"SetPasswordModalController",resolve:{user:function(){return $scope.getFirstSelectedUser()}}}),modalInstance.result.then(function(newPassword){return $scope.SetUserPassword(newPassword)})},$scope.SetUserPassword=function(newPassword){var selected_user;return selected_user=$scope.getFirstSelectedUser(),queuedHttp.post("/admin/user/"+selected_user._id+"/setPassword",{newPassword:newPassword,_csrf:window.csrfToken})},$scope.updateVisibleUsers()}),App.controller("UserListItemController",function($scope){return $scope.$watch("user.selected",function(value){return null!=value?$scope.updateSelectedUsers():void 0})}),App.controller("DeleteUsersModalController",function($scope,$modalInstance,$timeout,users){return $scope.users=users,$scope["delete"]=function(){return $modalInstance.close()},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("SetPasswordModalController",function($scope,$modalInstance,$timeout,user){return $scope.user=user,$scope.inputs={newPassword:""},$scope.setPassword=function(){return $modalInstance.close($scope.inputs.newPassword)},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}})})}.call(this),function(){define("main/admin-panel/controllers/AdminProjectController",["base","libs/md5"],function(App){return App.controller("AdminProjectController",function($scope,$timeout,$modal,queuedHttp){var project,_i,_len,_ref;for($scope.user=window.data.user,$scope.projects=window.data.projects,$scope.user.gravatar=CryptoJS.MD5($scope.user.email).toString(),$scope.selectedProjects=[],$scope.predicate="lastUpdated",$scope.reverse=!0,$scope.allSelected=!1,$scope.enableBetaError=!1,_ref=$scope.projects,_i=0,_len=_ref.length;_len>_i;_i++)project=_ref[_i],project.accessLevel="owner";return $scope.enableBetaForUser=function(){return $scope.enableBetaError=!1,queuedHttp({method:"POST",url:"/admin/user/"+$scope.user._id+"/setBetaStatus",headers:{"X-CSRF-Token":window.csrfToken,"Content-Type":"application/json"},data:{beta:!0}}).success(function(){return $scope.user.betaProgram=!0}).error(function(err){return console.error("Error",err),$scope.enableBetaError=!0})},$scope.disableBetaForUser=function(){return $scope.enableBetaError=!1,queuedHttp({method:"POST",url:"/admin/user/"+$scope.user._id+"/setBetaStatus",headers:{"X-CSRF-Token":window.csrfToken,"Content-Type":"application/json"},data:{beta:!1}}).success(function(){return $scope.user.betaProgram=!1}).error(function(err){return console.error("Error",err),$scope.enableBetaError=!0})},$scope.clearSearchText=function(){return $scope.searchText="",$scope.updateVisibleProjects()},$scope.searchProjects=function(){return $scope.updateVisibleProjects()},$scope.updateSelectedProjects=function(){return $scope.selectedProjects=$scope.projects.filter(function(project){return project.selected})},$scope.getSelectedProjects=function(){return $scope.selectedProjects},$scope.openArchiveProjectsModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"deleteProjectsModalTemplate",controller:"AdminDeleteProjectsModalController",resolve:{projects:function(){return $scope.getSelectedProjects()}}}),modalInstance.result.then(function(){return $scope.archiveOrLeaveSelectedProjects()})},$scope.archiveOrLeaveSelectedProjects=function(){var selected_projects,_j,_len1;for(selected_projects=$scope.getSelectedProjects(),_j=0,_len1=selected_projects.length;_len1>_j;_j++)project=selected_projects[_j],project.archived=!0,queuedHttp({method:"DELETE",url:"/admin/project/"+project._id,headers:{"X-CSRF-Token":window.csrfToken}});return $scope.updateVisibleProjects()},$scope.changePredicate=function(newPredicate){return $scope.predicate===newPredicate&&($scope.reverse=!$scope.reverse),$scope.predicate=newPredicate},$scope.getSortIconClass=function(column){return column===$scope.predicate&&$scope.reverse?"fa-caret-down":column!==$scope.predicate||$scope.reverse?"":"fa-caret-up"},$scope.openDeleteUserModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"deleteUsersModalTemplate",controller:"DeleteUsersModalController",resolve:{users:function(){return[$scope.user]}}}),modalInstance.result.then(function(){return $scope.DeleteUser()})},$scope.DeleteUser=function(){var user;return user=$scope.user,queuedHttp({method:"DELETE",url:"/admin/user/"+user._id,headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){return setTimeout(function(){return window.location.href="/admin/user"},100)})},$scope.openSetPasswordModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"setPasswordModalTemplate",controller:"SetPasswordModalController",resolve:{user:function(){return $scope.user}}}),modalInstance.result.then(function(newPassword){return $scope.SetUserPassword(newPassword)})},$scope.SetUserPassword=function(newPassword){return queuedHttp.post("/admin/user/"+$scope.user._id+"/setPassword",{newPassword:newPassword,_csrf:window.csrfToken})},$scope.updateVisibleProjects=function(){var visible,_j,_len1,_ref1,_results;for($scope.visibleProjects=[],_ref1=$scope.projects,_results=[],_j=0,_len1=_ref1.length;_len1>_j;_j++)project=_ref1[_j],visible=!0,null!=$scope.searchText&&""!==$scope.searchText&&(project.name.toLowerCase().match($scope.searchText.toLowerCase())||(visible=!1)),visible?_results.push($scope.visibleProjects.push(project)):_results.push(project.selected=!1);return _results},$scope.updateVisibleProjects()}),App.controller("AdminProjectListItemController",function($scope){return $scope.$watch("project.selected",function(value){return null!=value?$scope.updateSelectedProjects():void 0})}),App.controller("AdminDeleteProjectsModalController",function($scope,$modalInstance,$timeout,projects){return $scope.projectsToDelete=projects,$scope.action="Delete",$scope["delete"]=function(){return $modalInstance.close()},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}})})}.call(this),function(){define("main/admin-panel/controllers/AdminGraphController",["base","libs/md5"],function(App,md5){return App.controller("AdminGraphController",function($scope,$timeout,$location,$modal){var url;return $scope.user=window.data.user,$scope.user.gravatar=CryptoJS.MD5($scope.user.email).toString(),url=$location.absUrl(),$scope.level=url.substr(url.indexOf("level=")+6,1),$scope.config={graph:window.data.graph,container:"graph",type:"canvas",settings:{defaultNodeColor:"#ccc",edgeColor:"target",edgeLabelSize:"proportional",enableEdgeHovering:!0,edgeHoverColor:"edge",edgeHoverSizeRatio:3}},sigma.renderers.def=sigma.renderers.canvas,$scope.sGraph=new sigma($scope.config),$scope.sGraph.startForceAtlas2({worker:!0,barnesHutOptimize:!1}),$scope.sGraph.refresh(),$scope.sGraph.bind("clickNode",function(e){return $scope.selectedElement={name:e.data.node.label,id:e.data.node.id,type:"User",link:"/admin/user/"+e.data.node.id},$scope.openGraphModal()}),$scope.sGraph.bind("clickEdge",function(e){return $scope.selectedElement={name:e.data.edge.label,id:e.data.edge.projectId,type:"Project",link:"/admin/project/"+e.data.edge.projectId},$scope.openGraphModal()}),$timeout(function(){return $scope.sGraph.stopForceAtlas2()},500),$scope.openGraphModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"graphModalTemplate",controller:"GraphModalController",resolve:{element:function(){return $scope.selectedElement}}})}}),App.controller("GraphModalController",function($scope,$modalInstance,element){return $scope.element=element,$scope.close=function(){return $modalInstance.close()}})})}.call(this),function(){define("main/admin-panel/index",["main/admin-panel/controllers/AdminPanelController","main/admin-panel/controllers/AdminProjectController","main/admin-panel/controllers/AdminGraphController"],function(){})}.call(this),function(){define("main/github-sync/controllers/GithubSyncMenuEntryController",["base"],function(App){return App.controller("GithubSyncMenuEntryController",function($scope,$modal){return $scope.openImportModal=function(){return $modal.open({templateUrl:"githubSyncImportModalTemplate",controller:"GithubSyncImportModalController",size:"lg"})}})})}.call(this),function(){define("main/github-sync/controllers/GithubSyncImportModalController",["base"],function(App){return App.controller("GithubSyncImportModalController",function($scope,$modalInstance,$http){return $scope.cancel=function(){return $modalInstance.dismiss()},$scope.status={loading:!0,error:!1},$http.get("/user/github-sync/status",{disableAutoLoginRedirect:!0}).success(function(user){return $scope.status.user=user,user.enabled?$http.get("/user/github-sync/repos",{disableAutoLoginRedirect:!0}).success(function(data){return $scope.status.loading=!1,$scope.status.repos=data.repos}).error(function(data,statusCode){return null!=statusCode?$scope.status.error={statusCode:statusCode}:$scope.status.error=!0}):$scope.status.loading=!1}).error(function(){return $scope.status.error=!0}),$scope.importRepo=function(repo){return $scope.status.inflight=!0,$http.post("/project/new/github-sync",{_csrf:window.csrfToken,projectName:repo.name,repo:repo.full_name,disableAutoLoginRedirect:!0}).success(function(data){var project_id;return project_id=data.project_id,window.location="/project/"+project_id}).error(function(data,statusCode){return $scope.status.inflight=!1,null!=statusCode?$scope.status.error={statusCode:statusCode}:$scope.status.error=!0})}})})}.call(this),function(){define("main/github-sync/controllers/GithubSyncUnlinkController",["base"],function(App){return App.controller("GithubSyncUnlinkController",function($scope,$modal){return $scope.unlinkAccount=function(){return $modal.open({templateUrl:"githubSyncUnlinkModalTemplate"})}})})}.call(this),function(){define("main/github-sync/index",["main/github-sync/controllers/GithubSyncMenuEntryController","main/github-sync/controllers/GithubSyncImportModalController","main/github-sync/controllers/GithubSyncUnlinkController"],function(){})}.call(this),function(){define("main/templates/index",["base"],function(App){return App.controller("openInSlController",function($scope,$http,$window,$timeout){return $scope.openInSlText="Open in ShareLaTeX",$scope.isDisabled=!1,$scope.state={unpublishInFlight:!1,republishInFlight:!1,apiProblem:!1},$scope.buttonsDisabled=function(){return $scope.state.unpublishInFlight||$scope.state.republishInFlight},$scope.open=function(){return $scope.openInSlText="Creating...",$scope.isDisabled=!0,ga("send","event","template-site","open-in-sl",$(".page-header h1").text())},$scope.downloadZip=function(){return ga("send","event","template-site","download-zip",$(".page-header h1").text())},$scope.republish=function(projectId){return $scope.state.republishInFlight=!0,$http.post("/project/"+projectId+"/template/publish",{_csrf:window.csrfToken}).success(function(){return $scope.state.republishInFlight=!1,$scope.state.apiProblem=!1,$window.location.reload()}).error(function(){return $scope.state.republishInFlight=!1,$scope.state.apiProblem=!1})},$scope.unpublish=function(projectId){return $scope.state.unpublishInFlight=!0,$http.post("/project/"+projectId+"/template/unpublish",{_csrf:window.csrfToken}).success(function(){return $scope.state.unpublishInFlight=!1,$scope.state.apiProblem=!1,$timeout(function(){return $window.location.href="/templates"},500)}).error(function(){return $scope.state.unpublishInFlight=!1,console.log(">> unpub failed"),$scope.state.apiProblem=!0})}}),App.factory("algolia",function(){var client,index,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;return null!=("undefined"!=typeof window&&null!==window&&null!=(_ref=window.sharelatex)&&null!=(_ref1=_ref.algolia)?_ref1.app_id:void 0)?(client=new AlgoliaSearch(null!=(_ref2=window.sharelatex.algolia)?_ref2.app_id:void 0,null!=(_ref3=window.sharelatex.algolia)?_ref3.api_key:void 0),index=client.initIndex(null!=(_ref4=window.sharelatex.algolia)&&null!=(_ref5=_ref4.indexes)?_ref5.templates:void 0)):{}}),App.controller("SearchController",function($scope,algolia,_,$window){var buildHitViewModel,updateHits,_ref,_ref1;return $scope.hits=[],$scope.showSearch=null!=(null!=(_ref=$window.sharelatex.algolia)&&null!=(_ref1=_ref.indexes)?_ref1.templates:void 0),$scope.clearSearchText=function(){return $scope.searchQueryText="",updateHits([])},$scope.safeApply=function(fn){var phase;return phase=$scope.$root.$$phase,"$apply"===phase||"$digest"===phase?$scope.$eval(fn):$scope.$apply(fn)},buildHitViewModel=function(hit){var result,_ref2,_ref3;return result={name:hit._highlightResult.name.value,description:hit._highlightResult.description.value,url:"/templates/"+hit._id,image_url:""+(null!=(_ref2=window.sharelatex)&&null!=(_ref3=_ref2.templates)?_ref3.cdnDomain:void 0)+"/templates/"+hit._id+"/v/"+hit.version+"/pdf-converted-cache/style-thumbnail"}},updateHits=function(hits){return $scope.safeApply(function(){return $scope.hits=hits})},$scope.search=function(){var query,_ref2,_ref3;return query=$scope.searchQueryText,null==query||0===query.length?void updateHits([]):(query=""+(null!=(_ref2=window.sharelatex)&&null!=(_ref3=_ref2.templates)?_ref3.user_id:void 0)+" "+query,algolia.search(query,function(err,response){var hits;return 0===response.hits.length?updateHits([]):(hits=_.map(response.hits,buildHitViewModel),updateHits(hits))}))}}),App.controller("MissingTemplateController",function($scope,$modal){return $scope.showMissingTemplateModal=function(){return $modal.open({templateUrl:"missingTemplateModal",controller:"MissingTemplateModalController"})}}),App.controller("MissingTemplateModalController",function($scope,$modalInstance){return $scope.cancel=function(){return $modalInstance.dismiss()}})})}.call(this),function(){define("main/tpr-webmodule/controllers/ReferenceUnlinkController",["base"],function(App){return App.controller("ReferenceUnlinkController",function($scope,$modal){return $scope.unlinkAccount=function(providerStr){return $modal.open({templateUrl:"referenceUnlinkModalTemplate",controller:"ReferenceUnlinkModalController",resolve:{provider:function(){return providerStr}}})}}),App.controller("ReferenceUnlinkModalController",function($scope,$modalInstance,provider){return $scope.provider=provider,$scope.providerUnlink="/"+provider+"/unlink"})})}.call(this),function(){define("main/tpr-webmodule/index",["main/tpr-webmodule/controllers/ReferenceUnlinkController"],function(){})}.call(this),function(){define("main",["main/project-list/index","main/user-details","main/account-settings","main/clear-sessions","main/account-upgrade","main/plans","main/group-members","main/scribtex-popup","main/event","main/bonus","main/system-messages","main/translations","main/subscription-dashboard","main/new-subscription","main/annual-upgrade","main/announcements","main/register-users","main/subscription/group-subscription-invite-controller","main/contact-us","main/learn","analytics/AbTestingManager","directives/asyncForm","directives/stopPropagation","directives/focus","directives/equals","directives/fineUpload","directives/onEnter","directives/selectAll","directives/maxHeight","directives/creditCards","services/queued-http","filters/formatDate","main/admin-panel/index","main/github-sync/index","main/templates/index","main/tpr-webmodule/index"],function(){return angular.module("SharelatexApp").config(function($locationProvider){var e;try{return $locationProvider.html5Mode({enabled:!1,requireBase:!1,rewriteLinks:!1})}catch(_error){return e=_error,console.error("Error while trying to fix '#' links: ",e)}}),angular.bootstrap(document.body,["SharelatexApp"])})}.call(this);